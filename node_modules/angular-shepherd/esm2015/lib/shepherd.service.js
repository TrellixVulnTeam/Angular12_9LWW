import { Injectable } from '@angular/core';
import Shepherd from 'shepherd.js';
import { elementIsHidden } from './utils/dom';
import { makeButton } from './utils/buttons';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
export class ShepherdService {
    constructor() {
        this.confirmCancel = false;
        this.confirmCancelMessage = null;
        this.defaultStepOptions = {};
        this.errorTitle = null;
        this.isActive = false;
        this.messageForUser = null;
        this.modal = false;
        this.requiredElements = [];
        this.steps = [];
        this.tourName = undefined;
        this.tourObject = null;
    }
    /**
     * Get the tour object and call back
     */
    back() {
        this.tourObject.back();
    }
    /**
     * Cancel the tour
     */
    cancel() {
        this.tourObject.cancel();
    }
    /**
     * Complete the tour
     */
    complete() {
        this.tourObject.complete();
    }
    /**
     * Hides the current step
     */
    hide() {
        this.tourObject.hide();
    }
    /**
     * Advance the tour to the next step
     */
    next() {
        this.tourObject.next();
    }
    /**
     * Show a specific step, by passing its id
     * @param id The id of the step you want to show
     */
    show(id) {
        this.tourObject.show(id);
    }
    /**
     * Start the tour
     */
    start() {
        this.isActive = true;
        this.tourObject.start();
    }
    /**
     * This function is called when a tour is completed or cancelled to initiate cleanup.
     * @param completeOrCancel 'complete' or 'cancel'
     */
    onTourFinish(completeOrCancel) {
        this.isActive = false;
    }
    /**
     * Take a set of steps and create a tour object based on the current configuration
     * @param steps An array of steps
     */
    addSteps(steps) {
        this._initialize();
        const tour = this.tourObject;
        // Return nothing if there are no steps
        if (!steps || !Array.isArray(steps) || steps.length === 0) {
            return;
        }
        if (!this.requiredElementsPresent()) {
            tour.addStep({
                buttons: [{
                        text: 'Exit',
                        action: tour.cancel
                    }],
                id: 'error',
                title: this.errorTitle,
                text: [this.messageForUser]
            });
            return;
        }
        steps.forEach((step) => {
            if (step.buttons) {
                step.buttons = step.buttons.map(makeButton.bind(this), this);
            }
            tour.addStep(step);
        });
    }
    /**
     * Observes the array of requiredElements, which are the elements that must be present at the start of the tour,
     * and determines if they exist, and are visible, if either is false, it will stop the tour from executing.
     */
    requiredElementsPresent() {
        let allElementsPresent = true;
        /* istanbul ignore next: also can't test this due to things attached to root blowing up tests */
        this.requiredElements.forEach((element) => {
            const selectedElement = document.querySelector(element.selector);
            if (allElementsPresent && (!selectedElement || elementIsHidden(selectedElement))) {
                allElementsPresent = false;
                this.errorTitle = element.title;
                this.messageForUser = element.message;
            }
        });
        return allElementsPresent;
    }
    /**
     * Initializes the tour, creates a new Shepherd.Tour. sets options, and binds events
     */
    _initialize() {
        const tourObject = new Shepherd.Tour({
            confirmCancel: this.confirmCancel,
            confirmCancelMessage: this.confirmCancelMessage,
            defaultStepOptions: this.defaultStepOptions,
            tourName: this.tourName,
            useModalOverlay: this.modal
        });
        tourObject.on('complete', this.onTourFinish.bind(this, 'complete'));
        tourObject.on('cancel', this.onTourFinish.bind(this, 'cancel'));
        this.tourObject = tourObject;
    }
}
ShepherdService.ɵfac = function ShepherdService_Factory(t) { return new (t || ShepherdService)(); };
/** @nocollapse */ ShepherdService.ɵprov = i0.ɵɵdefineInjectable({ factory: function ShepherdService_Factory() { return new ShepherdService(); }, token: ShepherdService, providedIn: "root" });
/** @nocollapse */
ShepherdService.ctorParameters = () => [];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ShepherdService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return []; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlcGhlcmQuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc2hlcGhlcmQvc3JjL2xpYi9zaGVwaGVyZC5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxRQUFRLE1BQU0sYUFBYSxDQUFDO0FBQ25DLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdDOztBQUlBLE1BQU0sT0FBTyxlQUFlO0FBQzVCLElBWUU7QUFDRixRQWJFLGtCQUFhLEdBQUcsS0FBSyxDQUFDO0FBQ3hCLFFBQUUseUJBQW9CLEdBQVcsSUFBSSxDQUFDO0FBQ3RDLFFBQUUsdUJBQWtCLEdBQVcsRUFBRSxDQUFDO0FBQ2xDLFFBQUUsZUFBVSxHQUFHLElBQUksQ0FBQztBQUNwQixRQUFFLGFBQVEsR0FBRyxLQUFLLENBQUM7QUFDbkIsUUFBRSxtQkFBYyxHQUFXLElBQUksQ0FBQztBQUNoQyxRQUFFLFVBQUssR0FBRyxLQUFLLENBQUM7QUFDaEIsUUFBRSxxQkFBZ0IsR0FBRyxFQUFFLENBQUM7QUFDeEIsUUFBRSxVQUFLLEdBQUcsRUFBRSxDQUFDO0FBQ2IsUUFBRSxhQUFRLEdBQUcsU0FBUyxDQUFDO0FBQ3ZCLFFBQUUsZUFBVSxHQUFrQixJQUFJLENBQUM7QUFDbkMsSUFFRSxDQUFDO0FBQ0gsSUFDRTtBQUNGO0FBQ0UsT0FBRztBQUNMLElBQUUsSUFBSTtBQUNOLFFBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUMzQixJQUFFLENBQUM7QUFDSCxJQUNFO0FBQ0Y7QUFDRSxPQUFHO0FBQ0wsSUFBRSxNQUFNO0FBQ1IsUUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQzdCLElBQUUsQ0FBQztBQUNI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QztBQUNELGdNQXJKSztBQUFDO3dCQUhMLFVBQVUsbENBR2M7QUFIYixrQkFDVixVQUFVLEVBQUUsTUFBTSxjQUNuQjs7Ozs7Z0RBR1U7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCBTaGVwaGVyZCBmcm9tICdzaGVwaGVyZC5qcyc7XG5pbXBvcnQgeyBlbGVtZW50SXNIaWRkZW4gfSBmcm9tICcuL3V0aWxzL2RvbSc7XG5pbXBvcnQgeyBtYWtlQnV0dG9uIH0gZnJvbSAnLi91dGlscy9idXR0b25zJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgU2hlcGhlcmRTZXJ2aWNlIHtcbiAgY29uZmlybUNhbmNlbCA9IGZhbHNlO1xuICBjb25maXJtQ2FuY2VsTWVzc2FnZTogc3RyaW5nID0gbnVsbDtcbiAgZGVmYXVsdFN0ZXBPcHRpb25zOiBvYmplY3QgPSB7fTtcbiAgZXJyb3JUaXRsZSA9IG51bGw7XG4gIGlzQWN0aXZlID0gZmFsc2U7XG4gIG1lc3NhZ2VGb3JVc2VyOiBzdHJpbmcgPSBudWxsO1xuICBtb2RhbCA9IGZhbHNlO1xuICByZXF1aXJlZEVsZW1lbnRzID0gW107XG4gIHN0ZXBzID0gW107XG4gIHRvdXJOYW1lID0gdW5kZWZpbmVkO1xuICB0b3VyT2JqZWN0OiBTaGVwaGVyZC5Ub3VyID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvdXIgb2JqZWN0IGFuZCBjYWxsIGJhY2tcbiAgICovXG4gIGJhY2soKSB7XG4gICAgdGhpcy50b3VyT2JqZWN0LmJhY2soKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWwgdGhlIHRvdXJcbiAgICovXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLnRvdXJPYmplY3QuY2FuY2VsKCk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGxldGUgdGhlIHRvdXJcbiAgICovXG4gIGNvbXBsZXRlKCkge1xuICAgIHRoaXMudG91ck9iamVjdC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEhpZGVzIHRoZSBjdXJyZW50IHN0ZXBcbiAgICovXG4gIGhpZGUoKSB7XG4gICAgdGhpcy50b3VyT2JqZWN0LmhpZGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZHZhbmNlIHRoZSB0b3VyIHRvIHRoZSBuZXh0IHN0ZXBcbiAgICovXG4gIG5leHQoKSB7XG4gICAgdGhpcy50b3VyT2JqZWN0Lm5leHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTaG93IGEgc3BlY2lmaWMgc3RlcCwgYnkgcGFzc2luZyBpdHMgaWRcbiAgICogQHBhcmFtIGlkIFRoZSBpZCBvZiB0aGUgc3RlcCB5b3Ugd2FudCB0byBzaG93XG4gICAqL1xuICBzaG93KGlkKSB7XG4gICAgdGhpcy50b3VyT2JqZWN0LnNob3coaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSB0b3VyXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcbiAgICB0aGlzLnRvdXJPYmplY3Quc3RhcnQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCB3aGVuIGEgdG91ciBpcyBjb21wbGV0ZWQgb3IgY2FuY2VsbGVkIHRvIGluaXRpYXRlIGNsZWFudXAuXG4gICAqIEBwYXJhbSBjb21wbGV0ZU9yQ2FuY2VsICdjb21wbGV0ZScgb3IgJ2NhbmNlbCdcbiAgICovXG4gIG9uVG91ckZpbmlzaChjb21wbGV0ZU9yQ2FuY2VsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhIHNldCBvZiBzdGVwcyBhbmQgY3JlYXRlIGEgdG91ciBvYmplY3QgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0gc3RlcHMgQW4gYXJyYXkgb2Ygc3RlcHNcbiAgICovXG4gIGFkZFN0ZXBzKHN0ZXBzOiBBcnJheTxhbnk+KSB7XG4gICAgdGhpcy5faW5pdGlhbGl6ZSgpO1xuICAgIGNvbnN0IHRvdXIgPSB0aGlzLnRvdXJPYmplY3Q7XG5cbiAgICAvLyBSZXR1cm4gbm90aGluZyBpZiB0aGVyZSBhcmUgbm8gc3RlcHNcbiAgICBpZiAoIXN0ZXBzIHx8ICFBcnJheS5pc0FycmF5KHN0ZXBzKSB8fCBzdGVwcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMucmVxdWlyZWRFbGVtZW50c1ByZXNlbnQoKSkge1xuICAgICAgdG91ci5hZGRTdGVwKHtcbiAgICAgICAgYnV0dG9uczogW3tcbiAgICAgICAgICB0ZXh0OiAnRXhpdCcsXG4gICAgICAgICAgYWN0aW9uOiB0b3VyLmNhbmNlbFxuICAgICAgICB9XSxcbiAgICAgICAgaWQ6ICdlcnJvcicsXG4gICAgICAgIHRpdGxlOiB0aGlzLmVycm9yVGl0bGUsXG4gICAgICAgIHRleHQ6IFt0aGlzLm1lc3NhZ2VGb3JVc2VyXVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RlcHMuZm9yRWFjaCgoc3RlcCkgPT4ge1xuICAgICAgaWYgKHN0ZXAuYnV0dG9ucykge1xuICAgICAgICBzdGVwLmJ1dHRvbnMgPSBzdGVwLmJ1dHRvbnMubWFwKG1ha2VCdXR0b24uYmluZCh0aGlzKSwgdGhpcyk7XG4gICAgICB9XG5cbiAgICAgIHRvdXIuYWRkU3RlcChzdGVwKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPYnNlcnZlcyB0aGUgYXJyYXkgb2YgcmVxdWlyZWRFbGVtZW50cywgd2hpY2ggYXJlIHRoZSBlbGVtZW50cyB0aGF0IG11c3QgYmUgcHJlc2VudCBhdCB0aGUgc3RhcnQgb2YgdGhlIHRvdXIsXG4gICAqIGFuZCBkZXRlcm1pbmVzIGlmIHRoZXkgZXhpc3QsIGFuZCBhcmUgdmlzaWJsZSwgaWYgZWl0aGVyIGlzIGZhbHNlLCBpdCB3aWxsIHN0b3AgdGhlIHRvdXIgZnJvbSBleGVjdXRpbmcuXG4gICAqL1xuICBwcml2YXRlIHJlcXVpcmVkRWxlbWVudHNQcmVzZW50KCkge1xuICAgIGxldCBhbGxFbGVtZW50c1ByZXNlbnQgPSB0cnVlO1xuXG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGFsc28gY2FuJ3QgdGVzdCB0aGlzIGR1ZSB0byB0aGluZ3MgYXR0YWNoZWQgdG8gcm9vdCBibG93aW5nIHVwIHRlc3RzICovXG4gICAgdGhpcy5yZXF1aXJlZEVsZW1lbnRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IHNlbGVjdGVkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudC5zZWxlY3Rvcik7XG5cbiAgICAgIGlmIChhbGxFbGVtZW50c1ByZXNlbnQgJiYgKCFzZWxlY3RlZEVsZW1lbnQgfHwgZWxlbWVudElzSGlkZGVuKHNlbGVjdGVkRWxlbWVudCkpKSB7XG4gICAgICAgIGFsbEVsZW1lbnRzUHJlc2VudCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVycm9yVGl0bGUgPSBlbGVtZW50LnRpdGxlO1xuICAgICAgICB0aGlzLm1lc3NhZ2VGb3JVc2VyID0gZWxlbWVudC5tZXNzYWdlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGFsbEVsZW1lbnRzUHJlc2VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgdG91ciwgY3JlYXRlcyBhIG5ldyBTaGVwaGVyZC5Ub3VyLiBzZXRzIG9wdGlvbnMsIGFuZCBiaW5kcyBldmVudHNcbiAgICovXG4gIHByaXZhdGUgX2luaXRpYWxpemUoKSB7XG4gICAgY29uc3QgdG91ck9iamVjdCA9IG5ldyBTaGVwaGVyZC5Ub3VyKHtcbiAgICAgIGNvbmZpcm1DYW5jZWw6IHRoaXMuY29uZmlybUNhbmNlbCxcbiAgICAgIGNvbmZpcm1DYW5jZWxNZXNzYWdlOiB0aGlzLmNvbmZpcm1DYW5jZWxNZXNzYWdlLFxuICAgICAgZGVmYXVsdFN0ZXBPcHRpb25zOiB0aGlzLmRlZmF1bHRTdGVwT3B0aW9ucyxcbiAgICAgIHRvdXJOYW1lOiB0aGlzLnRvdXJOYW1lLFxuICAgICAgdXNlTW9kYWxPdmVybGF5OiB0aGlzLm1vZGFsXG4gICAgfSk7XG5cbiAgICB0b3VyT2JqZWN0Lm9uKCdjb21wbGV0ZScsIHRoaXMub25Ub3VyRmluaXNoLmJpbmQodGhpcywgJ2NvbXBsZXRlJykpO1xuICAgIHRvdXJPYmplY3Qub24oJ2NhbmNlbCcsIHRoaXMub25Ub3VyRmluaXNoLmJpbmQodGhpcywgJ2NhbmNlbCcpKTtcblxuICAgIHRoaXMudG91ck9iamVjdCA9IHRvdXJPYmplY3Q7XG4gIH1cbn1cbiJdfQ==