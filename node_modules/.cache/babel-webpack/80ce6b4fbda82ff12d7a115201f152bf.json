{"ast":null,"code":"/**\n * @module ol/render/canvas\n */\nimport BaseObject from '../Object.js';\nimport EventTarget from '../events/Target.js';\nimport { WORKER_OFFSCREEN_CANVAS } from '../has.js';\nimport { clear } from '../obj.js';\nimport { createCanvasContext2D } from '../dom.js';\nimport { getFontParameters } from '../css.js';\n/**\n * @typedef {Object} FillState\n * @property {import(\"../colorlike.js\").ColorLike} fillStyle FillStyle.\n */\n\n/**\n * @typedef Label\n * @property {number} width Width.\n * @property {number} height Height.\n * @property {Array<string|number>} contextInstructions ContextInstructions.\n */\n\n/**\n * @typedef {Object} FillStrokeState\n * @property {import(\"../colorlike.js\").ColorLike} [currentFillStyle] Current FillStyle.\n * @property {import(\"../colorlike.js\").ColorLike} [currentStrokeStyle] Current StrokeStyle.\n * @property {CanvasLineCap} [currentLineCap] Current LineCap.\n * @property {Array<number>} currentLineDash Current LineDash.\n * @property {number} [currentLineDashOffset] Current LineDashOffset.\n * @property {CanvasLineJoin} [currentLineJoin] Current LineJoin.\n * @property {number} [currentLineWidth] Current LineWidth.\n * @property {number} [currentMiterLimit] Current MiterLimit.\n * @property {number} [lastStroke] Last stroke.\n * @property {import(\"../colorlike.js\").ColorLike} [fillStyle] FillStyle.\n * @property {import(\"../colorlike.js\").ColorLike} [strokeStyle] StrokeStyle.\n * @property {CanvasLineCap} [lineCap] LineCap.\n * @property {Array<number>} lineDash LineDash.\n * @property {number} [lineDashOffset] LineDashOffset.\n * @property {CanvasLineJoin} [lineJoin] LineJoin.\n * @property {number} [lineWidth] LineWidth.\n * @property {number} [miterLimit] MiterLimit.\n */\n\n/**\n * @typedef {Object} StrokeState\n * @property {CanvasLineCap} lineCap LineCap.\n * @property {Array<number>} lineDash LineDash.\n * @property {number} lineDashOffset LineDashOffset.\n * @property {CanvasLineJoin} lineJoin LineJoin.\n * @property {number} lineWidth LineWidth.\n * @property {number} miterLimit MiterLimit.\n * @property {import(\"../colorlike.js\").ColorLike} strokeStyle StrokeStyle.\n */\n\n/**\n * @typedef {Object} TextState\n * @property {string} font Font.\n * @property {string} [textAlign] TextAlign.\n * @property {string} textBaseline TextBaseline.\n * @property {string} [placement] Placement.\n * @property {number} [maxAngle] MaxAngle.\n * @property {boolean} [overflow] Overflow.\n * @property {import(\"../style/Fill.js\").default} [backgroundFill] BackgroundFill.\n * @property {import(\"../style/Stroke.js\").default} [backgroundStroke] BackgroundStroke.\n * @property {import(\"../size.js\").Size} [scale] Scale.\n * @property {Array<number>} [padding] Padding.\n */\n\n/**\n * @typedef {Object} SerializableInstructions\n * @property {Array<*>} instructions The rendering instructions.\n * @property {Array<*>} hitDetectionInstructions The rendering hit detection instructions.\n * @property {Array<number>} coordinates The array of all coordinates.\n * @property {!Object<string, TextState>} [textStates] The text states (decluttering).\n * @property {!Object<string, FillState>} [fillStates] The fill states (decluttering).\n * @property {!Object<string, StrokeState>} [strokeStates] The stroke states (decluttering).\n */\n\n/**\n * @typedef {Object<number, import(\"./canvas/Executor.js\").ReplayImageOrLabelArgs>} DeclutterImageWithText\n */\n\n/**\n * @const\n * @type {string}\n */\n\nexport var defaultFont = '10px sans-serif';\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\n\nexport var defaultFillStyle = '#000';\n/**\n * @const\n * @type {CanvasLineCap}\n */\n\nexport var defaultLineCap = 'round';\n/**\n * @const\n * @type {Array<number>}\n */\n\nexport var defaultLineDash = [];\n/**\n * @const\n * @type {number}\n */\n\nexport var defaultLineDashOffset = 0;\n/**\n * @const\n * @type {CanvasLineJoin}\n */\n\nexport var defaultLineJoin = 'round';\n/**\n * @const\n * @type {number}\n */\n\nexport var defaultMiterLimit = 10;\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\n\nexport var defaultStrokeStyle = '#000';\n/**\n * @const\n * @type {string}\n */\n\nexport var defaultTextAlign = 'center';\n/**\n * @const\n * @type {string}\n */\n\nexport var defaultTextBaseline = 'middle';\n/**\n * @const\n * @type {Array<number>}\n */\n\nexport var defaultPadding = [0, 0, 0, 0];\n/**\n * @const\n * @type {number}\n */\n\nexport var defaultLineWidth = 1;\n/**\n * @type {BaseObject}\n */\n\nexport var checkedFonts = new BaseObject();\n/**\n * The label cache for text rendering. To change the default cache size of 2048\n * entries, use {@link module:ol/structs/LRUCache~LRUCache#setSize cache.setSize()}.\n * Deprecated - there is no label cache any more.\n * @type {?}\n * @api\n * @deprecated\n */\n\nexport var labelCache = new EventTarget();\n\nlabelCache.setSize = function () {\n  console.warn('labelCache is deprecated.'); //eslint-disable-line\n};\n/**\n * @type {CanvasRenderingContext2D}\n */\n\n\nvar measureContext = null;\n/**\n * @type {string}\n */\n\nvar measureFont;\n/**\n * @type {!Object<string, number>}\n */\n\nexport var textHeights = {};\n/**\n * Clears the label cache when a font becomes available.\n * @param {string} fontSpec CSS font spec.\n */\n\nexport var registerFont = function () {\n  var retries = 100;\n  var size = '32px ';\n  var referenceFonts = ['monospace', 'serif'];\n  var len = referenceFonts.length;\n  var text = 'wmytzilWMYTZIL@#/&?$%10\\uF013';\n  var interval, referenceWidth;\n  /**\n   * @param {string} fontStyle Css font-style\n   * @param {string} fontWeight Css font-weight\n   * @param {*} fontFamily Css font-family\n   * @return {boolean} Font with style and weight is available\n   */\n\n  function isAvailable(fontStyle, fontWeight, fontFamily) {\n    var available = true;\n\n    for (var i = 0; i < len; ++i) {\n      var referenceFont = referenceFonts[i];\n      referenceWidth = measureTextWidth(fontStyle + ' ' + fontWeight + ' ' + size + referenceFont, text);\n\n      if (fontFamily != referenceFont) {\n        var width = measureTextWidth(fontStyle + ' ' + fontWeight + ' ' + size + fontFamily + ',' + referenceFont, text); // If width and referenceWidth are the same, then the fallback was used\n        // instead of the font we wanted, so the font is not available.\n\n        available = available && width != referenceWidth;\n      }\n    }\n\n    if (available) {\n      return true;\n    }\n\n    return false;\n  }\n\n  function check() {\n    var done = true;\n    var fonts = checkedFonts.getKeys();\n\n    for (var i = 0, ii = fonts.length; i < ii; ++i) {\n      var font = fonts[i];\n\n      if (checkedFonts.get(font) < retries) {\n        if (isAvailable.apply(this, font.split('\\n'))) {\n          clear(textHeights); // Make sure that loaded fonts are picked up by Safari\n\n          measureContext = null;\n          measureFont = undefined;\n          checkedFonts.set(font, retries);\n        } else {\n          checkedFonts.set(font, checkedFonts.get(font) + 1, true);\n          done = false;\n        }\n      }\n    }\n\n    if (done) {\n      clearInterval(interval);\n      interval = undefined;\n    }\n  }\n\n  return function (fontSpec) {\n    var font = getFontParameters(fontSpec);\n\n    if (!font) {\n      return;\n    }\n\n    var families = font.families;\n\n    for (var i = 0, ii = families.length; i < ii; ++i) {\n      var family = families[i];\n      var key = font.style + '\\n' + font.weight + '\\n' + family;\n\n      if (checkedFonts.get(key) === undefined) {\n        checkedFonts.set(key, retries, true);\n\n        if (!isAvailable(font.style, font.weight, family)) {\n          checkedFonts.set(key, 0, true);\n\n          if (interval === undefined) {\n            interval = setInterval(check, 32);\n          }\n        }\n      }\n    }\n  };\n}();\n/**\n * @param {string} font Font to use for measuring.\n * @return {import(\"../size.js\").Size} Measurement.\n */\n\nexport var measureTextHeight = function () {\n  /**\n   * @type {HTMLDivElement}\n   */\n  var measureElement;\n  return function (fontSpec) {\n    var height = textHeights[fontSpec];\n\n    if (height == undefined) {\n      if (WORKER_OFFSCREEN_CANVAS) {\n        var font = getFontParameters(fontSpec);\n        var metrics = measureText(fontSpec, 'Å½g');\n        var lineHeight = isNaN(Number(font.lineHeight)) ? 1.2 : Number(font.lineHeight);\n        height = lineHeight * (metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent);\n      } else {\n        if (!measureElement) {\n          measureElement = document.createElement('div');\n          measureElement.innerHTML = 'M';\n          measureElement.style.minHeight = '0';\n          measureElement.style.maxHeight = 'none';\n          measureElement.style.height = 'auto';\n          measureElement.style.padding = '0';\n          measureElement.style.border = 'none';\n          measureElement.style.position = 'absolute';\n          measureElement.style.display = 'block';\n          measureElement.style.left = '-99999px';\n        }\n\n        measureElement.style.font = fontSpec;\n        document.body.appendChild(measureElement);\n        height = measureElement.offsetHeight;\n        document.body.removeChild(measureElement);\n      }\n\n      textHeights[fontSpec] = height;\n    }\n\n    return height;\n  };\n}();\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {TextMetrics} Text metrics.\n */\n\nfunction measureText(font, text) {\n  if (!measureContext) {\n    measureContext = createCanvasContext2D(1, 1);\n  }\n\n  if (font != measureFont) {\n    measureContext.font = font;\n    measureFont = measureContext.font;\n  }\n\n  return measureContext.measureText(text);\n}\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {number} Width.\n */\n\n\nexport function measureTextWidth(font, text) {\n  return measureText(font, text).width;\n}\n/**\n * Measure text width using a cache.\n * @param {string} font The font.\n * @param {string} text The text to measure.\n * @param {Object<string, number>} cache A lookup of cached widths by text.\n * @return {number} The text width.\n */\n\nexport function measureAndCacheTextWidth(font, text, cache) {\n  if (text in cache) {\n    return cache[text];\n  }\n\n  var width = measureTextWidth(font, text);\n  cache[text] = width;\n  return width;\n}\n/**\n * @param {string} font Font to use for measuring.\n * @param {Array<string>} lines Lines to measure.\n * @param {Array<number>} widths Array will be populated with the widths of\n * each line.\n * @return {number} Width of the whole text.\n */\n\nexport function measureTextWidths(font, lines, widths) {\n  var numLines = lines.length;\n  var width = 0;\n\n  for (var i = 0; i < numLines; ++i) {\n    var currentWidth = measureTextWidth(font, lines[i]);\n    width = Math.max(width, currentWidth);\n    widths.push(currentWidth);\n  }\n\n  return width;\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n * @param {number} offsetX X offset.\n * @param {number} offsetY Y offset.\n */\n\nexport function rotateAtOffset(context, rotation, offsetX, offsetY) {\n  if (rotation !== 0) {\n    context.translate(offsetX, offsetY);\n    context.rotate(rotation);\n    context.translate(-offsetX, -offsetY);\n  }\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {import(\"../transform.js\").Transform|null} transform Transform.\n * @param {number} opacity Opacity.\n * @param {Label|HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} labelOrImage Label.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} w Width.\n * @param {number} h Height.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {import(\"../size.js\").Size} scale Scale.\n */\n\nexport function drawImageOrLabel(context, transform, opacity, labelOrImage, originX, originY, w, h, x, y, scale) {\n  context.save();\n\n  if (opacity !== 1) {\n    context.globalAlpha *= opacity;\n  }\n\n  if (transform) {\n    context.setTransform.apply(context, transform);\n  }\n\n  if (\n  /** @type {*} */\n  labelOrImage.contextInstructions) {\n    // label\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    executeLabelInstructions(labelOrImage, context);\n  } else if (scale[0] < 0 || scale[1] < 0) {\n    // flipped image\n    context.translate(x, y);\n    context.scale(scale[0], scale[1]);\n    context.drawImage(labelOrImage, originX, originY, w, h, 0, 0, w, h);\n  } else {\n    // if image not flipped translate and scale can be avoided\n    context.drawImage(labelOrImage, originX, originY, w, h, x, y, w * scale[0], h * scale[1]);\n  }\n\n  context.restore();\n}\n/**\n * @param {Label} label Label.\n * @param {CanvasRenderingContext2D} context Context.\n */\n\nfunction executeLabelInstructions(label, context) {\n  var contextInstructions = label.contextInstructions;\n\n  for (var i = 0, ii = contextInstructions.length; i < ii; i += 2) {\n    if (Array.isArray(contextInstructions[i + 1])) {\n      context[contextInstructions[i]].apply(context, contextInstructions[i + 1]);\n    } else {\n      context[contextInstructions[i]] = contextInstructions[i + 1];\n    }\n  }\n}","map":{"version":3,"sources":["C:/Users/admin/Downloads/igo2-lib-master/igo2-lib-master/node_modules/ol/render/canvas.js"],"names":["BaseObject","EventTarget","WORKER_OFFSCREEN_CANVAS","clear","createCanvasContext2D","getFontParameters","defaultFont","defaultFillStyle","defaultLineCap","defaultLineDash","defaultLineDashOffset","defaultLineJoin","defaultMiterLimit","defaultStrokeStyle","defaultTextAlign","defaultTextBaseline","defaultPadding","defaultLineWidth","checkedFonts","labelCache","setSize","console","warn","measureContext","measureFont","textHeights","registerFont","retries","size","referenceFonts","len","length","text","interval","referenceWidth","isAvailable","fontStyle","fontWeight","fontFamily","available","i","referenceFont","measureTextWidth","width","check","done","fonts","getKeys","ii","font","get","apply","split","undefined","set","clearInterval","fontSpec","families","family","key","style","weight","setInterval","measureTextHeight","measureElement","height","metrics","measureText","lineHeight","isNaN","Number","actualBoundingBoxAscent","actualBoundingBoxDescent","document","createElement","innerHTML","minHeight","maxHeight","padding","border","position","display","left","body","appendChild","offsetHeight","removeChild","measureAndCacheTextWidth","cache","measureTextWidths","lines","widths","numLines","currentWidth","Math","max","push","rotateAtOffset","context","rotation","offsetX","offsetY","translate","rotate","drawImageOrLabel","transform","opacity","labelOrImage","originX","originY","w","h","x","y","scale","save","globalAlpha","setTransform","contextInstructions","executeLabelInstructions","drawImage","restore","label","Array","isArray"],"mappings":"AAAA;AACA;AACA;AACA,OAAOA,UAAP,MAAuB,cAAvB;AACA,OAAOC,WAAP,MAAwB,qBAAxB;AACA,SAASC,uBAAT,QAAwC,WAAxC;AACA,SAASC,KAAT,QAAsB,WAAtB;AACA,SAASC,qBAAT,QAAsC,WAAtC;AACA,SAASC,iBAAT,QAAkC,WAAlC;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;;AACA,OAAO,IAAIC,WAAW,GAAG,iBAAlB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,gBAAgB,GAAG,MAAvB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,cAAc,GAAG,OAArB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,eAAe,GAAG,EAAtB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,qBAAqB,GAAG,CAA5B;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,eAAe,GAAG,OAAtB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,iBAAiB,GAAG,EAAxB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,kBAAkB,GAAG,MAAzB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,gBAAgB,GAAG,QAAvB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,mBAAmB,GAAG,QAA1B;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,cAAc,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAArB;AACP;AACA;AACA;AACA;;AACA,OAAO,IAAIC,gBAAgB,G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","sourcesContent":["/**\n * @module ol/render/canvas\n */\nimport BaseObject from '../Object.js';\nimport EventTarget from '../events/Target.js';\nimport { WORKER_OFFSCREEN_CANVAS } from '../has.js';\nimport { clear } from '../obj.js';\nimport { createCanvasContext2D } from '../dom.js';\nimport { getFontParameters } from '../css.js';\n/**\n * @typedef {Object} FillState\n * @property {import(\"../colorlike.js\").ColorLike} fillStyle FillStyle.\n */\n/**\n * @typedef Label\n * @property {number} width Width.\n * @property {number} height Height.\n * @property {Array<string|number>} contextInstructions ContextInstructions.\n */\n/**\n * @typedef {Object} FillStrokeState\n * @property {import(\"../colorlike.js\").ColorLike} [currentFillStyle] Current FillStyle.\n * @property {import(\"../colorlike.js\").ColorLike} [currentStrokeStyle] Current StrokeStyle.\n * @property {CanvasLineCap} [currentLineCap] Current LineCap.\n * @property {Array<number>} currentLineDash Current LineDash.\n * @property {number} [currentLineDashOffset] Current LineDashOffset.\n * @property {CanvasLineJoin} [currentLineJoin] Current LineJoin.\n * @property {number} [currentLineWidth] Current LineWidth.\n * @property {number} [currentMiterLimit] Current MiterLimit.\n * @property {number} [lastStroke] Last stroke.\n * @property {import(\"../colorlike.js\").ColorLike} [fillStyle] FillStyle.\n * @property {import(\"../colorlike.js\").ColorLike} [strokeStyle] StrokeStyle.\n * @property {CanvasLineCap} [lineCap] LineCap.\n * @property {Array<number>} lineDash LineDash.\n * @property {number} [lineDashOffset] LineDashOffset.\n * @property {CanvasLineJoin} [lineJoin] LineJoin.\n * @property {number} [lineWidth] LineWidth.\n * @property {number} [miterLimit] MiterLimit.\n */\n/**\n * @typedef {Object} StrokeState\n * @property {CanvasLineCap} lineCap LineCap.\n * @property {Array<number>} lineDash LineDash.\n * @property {number} lineDashOffset LineDashOffset.\n * @property {CanvasLineJoin} lineJoin LineJoin.\n * @property {number} lineWidth LineWidth.\n * @property {number} miterLimit MiterLimit.\n * @property {import(\"../colorlike.js\").ColorLike} strokeStyle StrokeStyle.\n */\n/**\n * @typedef {Object} TextState\n * @property {string} font Font.\n * @property {string} [textAlign] TextAlign.\n * @property {string} textBaseline TextBaseline.\n * @property {string} [placement] Placement.\n * @property {number} [maxAngle] MaxAngle.\n * @property {boolean} [overflow] Overflow.\n * @property {import(\"../style/Fill.js\").default} [backgroundFill] BackgroundFill.\n * @property {import(\"../style/Stroke.js\").default} [backgroundStroke] BackgroundStroke.\n * @property {import(\"../size.js\").Size} [scale] Scale.\n * @property {Array<number>} [padding] Padding.\n */\n/**\n * @typedef {Object} SerializableInstructions\n * @property {Array<*>} instructions The rendering instructions.\n * @property {Array<*>} hitDetectionInstructions The rendering hit detection instructions.\n * @property {Array<number>} coordinates The array of all coordinates.\n * @property {!Object<string, TextState>} [textStates] The text states (decluttering).\n * @property {!Object<string, FillState>} [fillStates] The fill states (decluttering).\n * @property {!Object<string, StrokeState>} [strokeStates] The stroke states (decluttering).\n */\n/**\n * @typedef {Object<number, import(\"./canvas/Executor.js\").ReplayImageOrLabelArgs>} DeclutterImageWithText\n */\n/**\n * @const\n * @type {string}\n */\nexport var defaultFont = '10px sans-serif';\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport var defaultFillStyle = '#000';\n/**\n * @const\n * @type {CanvasLineCap}\n */\nexport var defaultLineCap = 'round';\n/**\n * @const\n * @type {Array<number>}\n */\nexport var defaultLineDash = [];\n/**\n * @const\n * @type {number}\n */\nexport var defaultLineDashOffset = 0;\n/**\n * @const\n * @type {CanvasLineJoin}\n */\nexport var defaultLineJoin = 'round';\n/**\n * @const\n * @type {number}\n */\nexport var defaultMiterLimit = 10;\n/**\n * @const\n * @type {import(\"../colorlike.js\").ColorLike}\n */\nexport var defaultStrokeStyle = '#000';\n/**\n * @const\n * @type {string}\n */\nexport var defaultTextAlign = 'center';\n/**\n * @const\n * @type {string}\n */\nexport var defaultTextBaseline = 'middle';\n/**\n * @const\n * @type {Array<number>}\n */\nexport var defaultPadding = [0, 0, 0, 0];\n/**\n * @const\n * @type {number}\n */\nexport var defaultLineWidth = 1;\n/**\n * @type {BaseObject}\n */\nexport var checkedFonts = new BaseObject();\n/**\n * The label cache for text rendering. To change the default cache size of 2048\n * entries, use {@link module:ol/structs/LRUCache~LRUCache#setSize cache.setSize()}.\n * Deprecated - there is no label cache any more.\n * @type {?}\n * @api\n * @deprecated\n */\nexport var labelCache = new EventTarget();\nlabelCache.setSize = function () {\n    console.warn('labelCache is deprecated.'); //eslint-disable-line\n};\n/**\n * @type {CanvasRenderingContext2D}\n */\nvar measureContext = null;\n/**\n * @type {string}\n */\nvar measureFont;\n/**\n * @type {!Object<string, number>}\n */\nexport var textHeights = {};\n/**\n * Clears the label cache when a font becomes available.\n * @param {string} fontSpec CSS font spec.\n */\nexport var registerFont = (function () {\n    var retries = 100;\n    var size = '32px ';\n    var referenceFonts = ['monospace', 'serif'];\n    var len = referenceFonts.length;\n    var text = 'wmytzilWMYTZIL@#/&?$%10\\uF013';\n    var interval, referenceWidth;\n    /**\n     * @param {string} fontStyle Css font-style\n     * @param {string} fontWeight Css font-weight\n     * @param {*} fontFamily Css font-family\n     * @return {boolean} Font with style and weight is available\n     */\n    function isAvailable(fontStyle, fontWeight, fontFamily) {\n        var available = true;\n        for (var i = 0; i < len; ++i) {\n            var referenceFont = referenceFonts[i];\n            referenceWidth = measureTextWidth(fontStyle + ' ' + fontWeight + ' ' + size + referenceFont, text);\n            if (fontFamily != referenceFont) {\n                var width = measureTextWidth(fontStyle +\n                    ' ' +\n                    fontWeight +\n                    ' ' +\n                    size +\n                    fontFamily +\n                    ',' +\n                    referenceFont, text);\n                // If width and referenceWidth are the same, then the fallback was used\n                // instead of the font we wanted, so the font is not available.\n                available = available && width != referenceWidth;\n            }\n        }\n        if (available) {\n            return true;\n        }\n        return false;\n    }\n    function check() {\n        var done = true;\n        var fonts = checkedFonts.getKeys();\n        for (var i = 0, ii = fonts.length; i < ii; ++i) {\n            var font = fonts[i];\n            if (checkedFonts.get(font) < retries) {\n                if (isAvailable.apply(this, font.split('\\n'))) {\n                    clear(textHeights);\n                    // Make sure that loaded fonts are picked up by Safari\n                    measureContext = null;\n                    measureFont = undefined;\n                    checkedFonts.set(font, retries);\n                }\n                else {\n                    checkedFonts.set(font, checkedFonts.get(font) + 1, true);\n                    done = false;\n                }\n            }\n        }\n        if (done) {\n            clearInterval(interval);\n            interval = undefined;\n        }\n    }\n    return function (fontSpec) {\n        var font = getFontParameters(fontSpec);\n        if (!font) {\n            return;\n        }\n        var families = font.families;\n        for (var i = 0, ii = families.length; i < ii; ++i) {\n            var family = families[i];\n            var key = font.style + '\\n' + font.weight + '\\n' + family;\n            if (checkedFonts.get(key) === undefined) {\n                checkedFonts.set(key, retries, true);\n                if (!isAvailable(font.style, font.weight, family)) {\n                    checkedFonts.set(key, 0, true);\n                    if (interval === undefined) {\n                        interval = setInterval(check, 32);\n                    }\n                }\n            }\n        }\n    };\n})();\n/**\n * @param {string} font Font to use for measuring.\n * @return {import(\"../size.js\").Size} Measurement.\n */\nexport var measureTextHeight = (function () {\n    /**\n     * @type {HTMLDivElement}\n     */\n    var measureElement;\n    return function (fontSpec) {\n        var height = textHeights[fontSpec];\n        if (height == undefined) {\n            if (WORKER_OFFSCREEN_CANVAS) {\n                var font = getFontParameters(fontSpec);\n                var metrics = measureText(fontSpec, 'Å½g');\n                var lineHeight = isNaN(Number(font.lineHeight))\n                    ? 1.2\n                    : Number(font.lineHeight);\n                height =\n                    lineHeight *\n                        (metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent);\n            }\n            else {\n                if (!measureElement) {\n                    measureElement = document.createElement('div');\n                    measureElement.innerHTML = 'M';\n                    measureElement.style.minHeight = '0';\n                    measureElement.style.maxHeight = 'none';\n                    measureElement.style.height = 'auto';\n                    measureElement.style.padding = '0';\n                    measureElement.style.border = 'none';\n                    measureElement.style.position = 'absolute';\n                    measureElement.style.display = 'block';\n                    measureElement.style.left = '-99999px';\n                }\n                measureElement.style.font = fontSpec;\n                document.body.appendChild(measureElement);\n                height = measureElement.offsetHeight;\n                document.body.removeChild(measureElement);\n            }\n            textHeights[fontSpec] = height;\n        }\n        return height;\n    };\n})();\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {TextMetrics} Text metrics.\n */\nfunction measureText(font, text) {\n    if (!measureContext) {\n        measureContext = createCanvasContext2D(1, 1);\n    }\n    if (font != measureFont) {\n        measureContext.font = font;\n        measureFont = measureContext.font;\n    }\n    return measureContext.measureText(text);\n}\n/**\n * @param {string} font Font.\n * @param {string} text Text.\n * @return {number} Width.\n */\nexport function measureTextWidth(font, text) {\n    return measureText(font, text).width;\n}\n/**\n * Measure text width using a cache.\n * @param {string} font The font.\n * @param {string} text The text to measure.\n * @param {Object<string, number>} cache A lookup of cached widths by text.\n * @return {number} The text width.\n */\nexport function measureAndCacheTextWidth(font, text, cache) {\n    if (text in cache) {\n        return cache[text];\n    }\n    var width = measureTextWidth(font, text);\n    cache[text] = width;\n    return width;\n}\n/**\n * @param {string} font Font to use for measuring.\n * @param {Array<string>} lines Lines to measure.\n * @param {Array<number>} widths Array will be populated with the widths of\n * each line.\n * @return {number} Width of the whole text.\n */\nexport function measureTextWidths(font, lines, widths) {\n    var numLines = lines.length;\n    var width = 0;\n    for (var i = 0; i < numLines; ++i) {\n        var currentWidth = measureTextWidth(font, lines[i]);\n        width = Math.max(width, currentWidth);\n        widths.push(currentWidth);\n    }\n    return width;\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {number} rotation Rotation.\n * @param {number} offsetX X offset.\n * @param {number} offsetY Y offset.\n */\nexport function rotateAtOffset(context, rotation, offsetX, offsetY) {\n    if (rotation !== 0) {\n        context.translate(offsetX, offsetY);\n        context.rotate(rotation);\n        context.translate(-offsetX, -offsetY);\n    }\n}\n/**\n * @param {CanvasRenderingContext2D} context Context.\n * @param {import(\"../transform.js\").Transform|null} transform Transform.\n * @param {number} opacity Opacity.\n * @param {Label|HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} labelOrImage Label.\n * @param {number} originX Origin X.\n * @param {number} originY Origin Y.\n * @param {number} w Width.\n * @param {number} h Height.\n * @param {number} x X.\n * @param {number} y Y.\n * @param {import(\"../size.js\").Size} scale Scale.\n */\nexport function drawImageOrLabel(context, transform, opacity, labelOrImage, originX, originY, w, h, x, y, scale) {\n    context.save();\n    if (opacity !== 1) {\n        context.globalAlpha *= opacity;\n    }\n    if (transform) {\n        context.setTransform.apply(context, transform);\n    }\n    if ( /** @type {*} */(labelOrImage).contextInstructions) {\n        // label\n        context.translate(x, y);\n        context.scale(scale[0], scale[1]);\n        executeLabelInstructions(/** @type {Label} */ (labelOrImage), context);\n    }\n    else if (scale[0] < 0 || scale[1] < 0) {\n        // flipped image\n        context.translate(x, y);\n        context.scale(scale[0], scale[1]);\n        context.drawImage(\n        /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */ (labelOrImage), originX, originY, w, h, 0, 0, w, h);\n    }\n    else {\n        // if image not flipped translate and scale can be avoided\n        context.drawImage(\n        /** @type {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} */ (labelOrImage), originX, originY, w, h, x, y, w * scale[0], h * scale[1]);\n    }\n    context.restore();\n}\n/**\n * @param {Label} label Label.\n * @param {CanvasRenderingContext2D} context Context.\n */\nfunction executeLabelInstructions(label, context) {\n    var contextInstructions = label.contextInstructions;\n    for (var i = 0, ii = contextInstructions.length; i < ii; i += 2) {\n        if (Array.isArray(contextInstructions[i + 1])) {\n            context[contextInstructions[i]].apply(context, contextInstructions[i + 1]);\n        }\n        else {\n            context[contextInstructions[i]] = contextInstructions[i + 1];\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}