{"version":3,"file":"igo2-geo.js","sources":["../../../packages/geo/src/lib/metadata/shared/metadata.service.ts","../../../packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","../../../packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","../../../packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","../../../packages/geo/src/lib/metadata/metadata.module.ts","../../../packages/geo/src/lib/feature/shared/feature.enums.ts","../../../packages/geo/src/lib/layer/utils/image-watcher.ts","../../../packages/geo/src/lib/layer/utils/layer.utils.ts","../../../packages/geo/src/lib/layer/shared/layers/layer.interface.ts","../../../packages/geo/src/lib/utils/id-generator.ts","../../../packages/geo/src/lib/datasource/shared/datasources/datasource.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.ts","../../../packages/geo/src/lib/query/shared/query.enums.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","../../../packages/geo/src/lib/layer/utils/layerSync-watcher.ts","../../../packages/geo/src/lib/layer/utils/tile-watcher.ts","../../../packages/geo/src/lib/layer/utils/outputLegend.ts","../../../packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","../../../packages/geo/src/lib/layer/utils/vector-watcher.ts","../../../packages/geo/src/lib/map/shared/map.utils.ts","../../../packages/geo/src/lib/layer/shared/layers/layer.ts","../../../packages/geo/src/lib/layer/shared/layers/vector-layer.ts","../../../packages/geo/src/lib/datasource/shared/datasources/data.service.ts","../../../packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","../../../packages/geo/src/lib/datasource/utils/tilegrid.ts","../../../packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","../../../packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","../../../packages/geo/src/lib/datasource/utils/esri-style-generator.ts","../../../packages/geo/src/lib/filter/shared/time-filter.enum.ts","../../../packages/geo/src/lib/map/shared/map.service.ts","../../../packages/geo/src/lib/datasource/shared/capabilities.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options.service.ts","../../../packages/geo/src/lib/map/shared/projection.service.ts","../../../packages/geo/src/lib/datasource/shared/datasource.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options-api.service.ts","../../../packages/geo/src/lib/datasource/shared/options/options-api.providers.ts","../../../packages/geo/src/lib/feature/shared/feature.utils.ts","../../../packages/geo/src/lib/feature/shared/store.ts","../../../packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","../../../packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","../../../packages/geo/src/lib/feature/shared/strategies/loading.ts","../../../packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","../../../packages/geo/src/lib/feature/shared/strategies/selection.ts","../../../packages/geo/src/lib/feature/shared/strategies.utils.ts","../../../packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","../../../packages/geo/src/lib/layer/shared/style.service.ts","../../../packages/geo/src/lib/overlay/shared/overlay.utils.ts","../../../packages/geo/src/lib/overlay/shared/overlay.ts","../../../packages/geo/src/lib/map/utils/layer-watcher.ts","../../../packages/geo/src/lib/map/shared/map.enums.ts","../../../packages/geo/src/lib/map/shared/controllers/controller.ts","../../../packages/geo/src/lib/map/shared/controllers/view.ts","../../../packages/geo/src/lib/map/shared/map.ts","../../../packages/geo/src/lib/map/map-browser/map-browser.component.ts","../../../packages/geo/src/lib/map/map-browser/map-browser.component.html","../../../packages/geo/src/lib/map/shared/mapOffline.directive.ts","../../../packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","../../../packages/geo/src/lib/layer/shared/layers/image-layer.ts","../../../packages/geo/src/lib/layer/shared/layers/tile-layer.ts","../../../packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","../../../packages/geo/src/lib/map/shared/hover-feature.directive.ts","../../../packages/geo/src/lib/map/shared/projection.utils.ts","../../../packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","../../../packages/geo/src/lib/map/zoom-button/zoom-button.component.html","../../../packages/geo/src/lib/map/menu-button/menu-button.component.ts","../../../packages/geo/src/lib/map/menu-button/menu-button.component.html","../../../packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","../../../packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","../../../packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","../../../packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","../../../packages/geo/src/lib/map/offline-button/offline-button.component.html","../../../packages/geo/src/lib/map/offline-button/offline-button.component.ts","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","../../../packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","../../../packages/geo/src/lib/layer/shared/layer.service.ts","../../../packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","../../../packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","../../../packages/geo/src/lib/map/rotation-button/rotation-button.component.html","../../../packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","../../../packages/geo/src/lib/map/swipe-control/swipe-control.component.ts","../../../packages/geo/src/lib/map/swipe-control/swipe-control.component.html","../../../packages/geo/src/lib/map/map-center/map-center.component.ts","../../../packages/geo/src/lib/map/map-center/map-center.component.html","../../../packages/geo/src/lib/map/info-section/info-section.component.html","../../../packages/geo/src/lib/map/info-section/info-section.component.ts","../../../packages/geo/src/lib/catalog/shared/catalog.enum.ts","../../../packages/geo/src/lib/catalog/shared/catalog.abstract.ts","../../../packages/geo/src/lib/query/shared/query.service.ts","../../../packages/geo/src/lib/query/shared/query.utils.ts","../../../packages/geo/src/lib/query/shared/query.directive.ts","../../../packages/geo/src/lib/search/shared/sources/source.ts","../../../packages/geo/src/lib/query/shared/query-search-source.ts","../../../packages/geo/src/lib/utils/googleLinks.ts","../../../packages/geo/src/lib/utils/commonVectorStyle.ts","../../../packages/geo/src/lib/utils/osmLinks.ts","../../../packages/geo/src/lib/catalog/shared/catalog.service.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","../../../packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","../../../packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","../../../packages/geo/src/lib/layer/layer-item/layer-item.component.html","../../../packages/geo/src/lib/layer/layer-item/layer-item.component.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list.component.html","../../../packages/geo/src/lib/layer/layer-list/layer-list.component.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","../../../packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","../../../packages/geo/src/lib/layer/layer-legend-list/layer-legend-list-binding.directive.ts","../../../packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","../../../packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","../../../packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","../../../packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","../../../packages/geo/src/lib/layer/layer.module.ts","../../../packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","../../../packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","../../../packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","../../../packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","../../../packages/geo/src/lib/catalog/catalog.module.ts","../../../packages/geo/src/lib/datasource/datasource.module.ts","../../../packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","../../../packages/geo/src/lib/filter/shared/time-filter.service.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter.service.ts","../../../packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","../../../packages/geo/src/lib/filter/shared/spatial-filter.service.ts","../../../packages/geo/src/lib/download/shared/download.service.ts","../../../packages/geo/src/lib/download/download-button/download-button.component.html","../../../packages/geo/src/lib/download/download-button/download-button.component.ts","../../../packages/geo/src/lib/download/download.module.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.component.html","../../../packages/geo/src/lib/feature/feature-details/feature-details.component.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.component.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.component.html","../../../packages/geo/src/lib/draw/shared/draw.enum.ts","../../../packages/geo/src/lib/geometry/shared/geometry.errors.ts","../../../packages/geo/src/lib/geometry/shared/geometry.utils.ts","../../../packages/geo/src/lib/geometry/shared/controls/draw.ts","../../../packages/geo/src/lib/draw/draw/draw-popup.component.ts","../../../packages/geo/src/lib/draw/draw/draw-popup.component.html","../../../packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","../../../packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","../../../packages/geo/src/lib/measure/shared/measure.enum.ts","../../../packages/geo/src/lib/measure/shared/measure.utils.ts","../../../packages/geo/src/lib/draw/shared/draw.utils.ts","../../../packages/geo/src/lib/draw/shared/draw-style.service.ts","../../../packages/geo/src/lib/draw/shared/draw-icon.service.ts","../../../packages/geo/src/lib/draw/draw/draw.component.html","../../../packages/geo/src/lib/draw/draw/draw.component.ts","../../../packages/geo/src/lib/draw/draw/draw.module.ts","../../../packages/geo/src/lib/draw/drawingTool.module.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.directive.ts","../../../packages/geo/src/lib/feature/feature-details/feature-details.module.ts","../../../packages/geo/src/lib/feature/feature-form/feature-form.module.ts","../../../packages/geo/src/lib/feature/feature.module.ts","../../../packages/geo/src/lib/geometry/shared/controls/modify.ts","../../../packages/geo/src/lib/geometry/shared/controls/slice.ts","../../../packages/geo/src/lib/layer/shared/layer.enums.ts","../../../packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.enum.ts","../../../packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","../../../packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","../../../packages/geo/src/lib/measure/measurer/measurer.component.html","../../../packages/geo/src/lib/measure/measurer/measurer.component.ts","../../../packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.html","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.component.ts","../../../packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","../../../packages/geo/src/lib/geometry/geometry.module.ts","../../../packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","../../../packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","../../../packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","../../../packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","../../../packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","../../../packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","../../../packages/geo/src/lib/filter/time-filter-list/time-filter-list-binding.directive.ts","../../../packages/geo/src/lib/wkt/shared/wkt.service.ts","../../../packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","../../../packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","../../../packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list-binding.directive.ts","../../../packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","../../../packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","../../../packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","../../../packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","../../../packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","../../../packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","../../../packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","../../../packages/geo/src/lib/filter/filter.module.ts","../../../packages/geo/src/lib/import-export/export-button/export-button.component.html","../../../packages/geo/src/lib/import-export/export-button/export-button.component.ts","../../../packages/geo/src/lib/import-export/shared/export.errors.ts","../../../packages/geo/src/lib/import-export/shared/export.utils.ts","../../../packages/geo/src/lib/import-export/shared/export.type.ts","../../../packages/geo/src/lib/import-export/shared/export.service.ts","../../../packages/geo/src/lib/import-export/shared/import.utils.ts","../../../packages/geo/src/lib/import-export/shared/import.errors.ts","../../../packages/geo/src/lib/import-export/shared/import.service.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.service.ts","../../../packages/geo/src/lib/import-export/import-export/import-export.component.html","../../../packages/geo/src/lib/import-export/import-export/import-export.component.ts","../../../packages/geo/src/lib/import-export/shared/drop-geo-file.directive.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.provider.ts","../../../packages/geo/src/lib/import-export/style-list/style-list.module.ts","../../../packages/geo/src/lib/import-export/import-export.module.ts","../../../packages/geo/src/lib/map/map.module.ts","../../../packages/geo/src/lib/measure/measurer/measurer-item.component.html","../../../packages/geo/src/lib/measure/measurer/measurer-item.component.ts","../../../packages/geo/src/lib/measure/measurer/measurer.module.ts","../../../packages/geo/src/lib/measure/measure.module.ts","../../../packages/geo/src/lib/overlay/shared/overlay.enum.ts","../../../packages/geo/src/lib/overlay/shared/overlay.service.ts","../../../packages/geo/src/lib/overlay/shared/overlay.directive.ts","../../../packages/geo/src/lib/overlay/overlay.module.ts","../../../packages/geo/src/lib/print/shared/print.service.ts","../../../packages/geo/src/lib/print/shared/print.type.ts","../../../packages/geo/src/lib/print/print-form/print-form.component.html","../../../packages/geo/src/lib/print/print-form/print-form.component.ts","../../../packages/geo/src/lib/print/print/print.component.ts","../../../packages/geo/src/lib/print/print/print.component.html","../../../packages/geo/src/lib/print/print.module.ts","../../../packages/geo/src/lib/query/shared/query-search-source.providers.ts","../../../packages/geo/src/lib/query/query.module.ts","../../../packages/geo/src/lib/directions/directions-sources/directions-source.ts","../../../packages/geo/src/lib/directions/shared/directions-source.service.ts","../../../packages/geo/src/lib/directions/shared/directions.enum.ts","../../../packages/geo/src/lib/directions/shared/directions.utils.ts","../../../packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","../../../packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","../../../packages/geo/src/lib/directions/shared/directions.service.ts","../../../packages/geo/src/lib/search/shared/search.utils.ts","../../../packages/geo/src/lib/search/shared/search-source.service.ts","../../../packages/geo/src/lib/search/shared/search.service.ts","../../../packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","../../../packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","../../../packages/geo/src/lib/directions/directions-results/directions-results.component.html","../../../packages/geo/src/lib/directions/directions-results/directions-results.component.ts","../../../packages/geo/src/lib/directions/directions.component.ts","../../../packages/geo/src/lib/directions/directions.component.html","../../../packages/geo/src/lib/directions/directions.module.ts","../../../packages/geo/src/lib/search/shared/search-source-service.providers.ts","../../../packages/geo/src/lib/search/shared/sources/icherche.ts","../../../packages/geo/src/lib/search/shared/sources/icherche.providers.ts","../../../packages/geo/src/lib/search/shared/sources/coordinates.ts","../../../packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","../../../packages/geo/src/lib/search/shared/sources/ilayer.ts","../../../packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","../../../packages/geo/src/lib/search/shared/search.enums.ts","../../../packages/geo/src/lib/search/search-selector/search-selector.component.html","../../../packages/geo/src/lib/search/search-selector/search-selector.component.ts","../../../packages/geo/src/lib/search/search-selector/search-selector.module.ts","../../../packages/geo/src/lib/search/search-settings/search-settings.component.html","../../../packages/geo/src/lib/search/search-settings/search-settings.component.ts","../../../packages/geo/src/lib/search/search-settings/search-settings.module.ts","../../../packages/geo/src/lib/search/search-bar/search-bar.component.html","../../../packages/geo/src/lib/search/search-bar/search-bar.component.ts","../../../packages/geo/src/lib/search/search-bar/search-url-param.directive.ts","../../../packages/geo/src/lib/search/search-bar/search-bar.module.ts","../../../packages/geo/src/lib/search/search-results/search-results-item.component.html","../../../packages/geo/src/lib/search/search-results/search-results-item.component.ts","../../../packages/geo/src/lib/search/search-results/search-results.component.html","../../../packages/geo/src/lib/search/search-results/search-results.component.ts","../../../packages/geo/src/lib/search/search-results/search-results-add-button.component.html","../../../packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","../../../packages/geo/src/lib/search/search-results/search-results.module.ts","../../../packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","../../../packages/geo/src/lib/search/search.module.ts","../../../packages/geo/src/lib/toast/toast.component.html","../../../packages/geo/src/lib/toast/toast.component.ts","../../../packages/geo/src/lib/toast/toast.module.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","../../../packages/geo/src/lib/workspace/widgets/widgets.ts","../../../packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","../../../packages/geo/src/lib/workspace/shared/wfs-workspace.ts","../../../packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","../../../packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","../../../packages/geo/src/lib/workspace/shared/edition-workspace.ts","../../../packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","../../../packages/geo/src/lib/workspace/shared/feature-workspace.ts","../../../packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","../../../packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","../../../packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","../../../packages/geo/src/lib/workspace/workspace-updator/workspace-updator.directive.ts","../../../packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","../../../packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","../../../packages/geo/src/lib/workspace/workspace.module.ts","../../../packages/geo/src/lib/wkt/wkt.module.ts","../../../packages/geo/src/lib/geo.module.ts","../../../packages/geo/src/lib/directions/shared/store.ts","../../../packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","../../../packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","../../../packages/geo/src/lib/search/shared/sources/cadastre.ts","../../../packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","../../../packages/geo/src/lib/search/shared/sources/nominatim.ts","../../../packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","../../../packages/geo/src/lib/search/shared/sources/storedqueries.ts","../../../packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","../../../packages/geo/src/lib/workspace/shared/workspace.utils.ts","../../../packages/geo/src/public_api.ts","../../../packages/geo/src/igo2-geo.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      this.metadataService.open(metadata);\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n  private languageService: LanguageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n    this.languageService = languageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    const title = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailableTitle'\n    );\n    const message = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\n    );\n\n    this.messageService.error(message, title);\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import { AnyLayerOptions } from \"../shared/layers/any-layer.interface\";\nimport { VectorTileLayerOptions } from \"../shared/layers/vectortile-layer.interface\";\n\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.styleByAttribute?.hoverStyle || vectorTileLayerOptions.hoverStyle)) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  bidirectionnal?: boolean;\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id || this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary,\n          wfsUpperBoundary\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern.replace(/[()_]/gi, wfsSingleChar),\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n\n    if (!processedFilter) {return undefined;};\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ... { gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions, OgcFilterDuringOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select)\n        ? false\n        : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n          const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n          if(filterDuring.calendarModeYear) {\n            initOgcFilters.advancedOgcFilters = false;\n          }\n      }\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import { Watcher } from '@igo2/utils';\nimport { Layer } from '../shared/layers/layer';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayersLink, LinkedProperties } from '../shared/layers/layer.interface';\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { TimeFilterableDataSource } from '../../filter/shared/time-filter.interface';\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nexport class LayerSyncWatcher extends Watcher {\n    private ogcFilters$$: Subscription;\n    private timeFilter$$: Subscription;\n\n    private ol: olLayer<olSource>;\n    private layer: Layer;\n    private dataSource: DataSource;\n    private map: IgoMap;\n    private ogcFilterWriter;\n\n    constructor(layer: Layer, map: IgoMap) {\n        super();\n        this.ol = layer.ol;\n        this.layer = layer;\n        this.dataSource = layer.options.source;\n        this.map = map;\n        this.ogcFilterWriter = new OgcFilterWriter();\n    }\n\n    protected watch() {\n\n        this.ol.on('propertychange', evt => this.transferCommonProperties(evt));\n        if ((this.dataSource as OgcFilterableDataSource).ogcFilters$) {\n            this.ogcFilters$$ = (this.dataSource as OgcFilterableDataSource).ogcFilters$\n                .subscribe(ogcFilters => this.transferOgcFiltersProperties(ogcFilters));\n        }\n        if ((this.dataSource as TimeFilterableDataSource).timeFilter$) {\n            this.timeFilter$$ = (this.dataSource as TimeFilterableDataSource).timeFilter$\n                .subscribe(timeFilter => this.transferTimeFilterProperties(timeFilter));\n        }\n        this.syncChildLayers();\n    }\n\n    protected unwatch() {\n        this.ol.un('propertychange', evt => this.transferCommonProperties(evt));\n        if (this.ogcFilters$$) { this.ogcFilters$$.unsubscribe(); }\n        if (this.timeFilter$$) { this.timeFilter$$.unsubscribe(); }\n    }\n\n\n    private syncChildLayers() {\n        // Force the sync the child layers with parent on the first load.\n        if (!this.map) {\n            return;\n        }\n        this.map.status$\n            .pipe(first())\n            .subscribe(() => {\n                this.map.layers\n                    .filter(layer => layer.options.linkedLayers?.links)\n                    .map(layer => {\n                        layer.options.linkedLayers.links.map(link => {\n                            if (link.properties?.indexOf(LinkedProperties.VISIBLE) !== -1) {\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.visible = layer.visible;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OPACITY) !== -1) {\n                                const baseOpacity = layer.ol.get('opacity');\n                                layer.ol.set('opacity', 0, false);\n                                layer.ol.set('opacity', baseOpacity, false);\n                                layer.opacity = layer.opacity;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MINRESOLUTION) !== -1) {\n                                const baseMinResolution = layer.ol.get('minResolution');\n                                layer.ol.set('minResolution', 0, false);\n                                layer.ol.set('minResolution', baseMinResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MAXRESOLUTION) !== -1) {\n                                const baseMaxResolution = layer.ol.get('maxResolution');\n                                layer.ol.set('maxResolution', 0, false);\n                                layer.ol.set('maxResolution', baseMaxResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OGCFILTERS) !== -1) {\n                                const ogcFilters$ = (layer.dataSource as OgcFilterableDataSource).ogcFilters$;\n                                ogcFilters$.next(ogcFilters$.value);\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.TIMEFILTER) !== -1) {\n                                const timeFilter$ = (layer.dataSource as TimeFilterableDataSource).timeFilter$;\n                                timeFilter$.next(timeFilter$.value);\n                            }\n                        });\n                    });\n            });\n    }\n\n    private transferCommonProperties(layerChange) {\n        const key = layerChange.key;\n        const layerChangeProperties = layerChange.target.getProperties();\n        const newValue = layerChangeProperties[key];\n\n        if (['visible', 'opacity', 'minResolution', 'maxResolution'].indexOf(key) === -1) {\n            return;\n        }\n        const linkedLayers = layerChangeProperties.linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n\n        if (isParentLayer) {\n            // search for child layers\n            const silent = true;\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(key) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        layerToApply.ol.set(key, newValue, silent);\n                        if (key === 'visible') {\n                            layerToApply.visible$.next(newValue);\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            const silent = false;\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(key) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            layer.ol.set(key, newValue, silent);\n                            if (key === 'visible') {\n                                layer.visible$.next(newValue);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferOgcFiltersProperties(ogcFilters) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.OGCFILTERS) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        const layerType = layerToApply.ol.getProperties().sourceOptions.type;\n                        (layerToApply.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, false);\n                        if (layerType === 'wfs') {\n                            layerToApply.ol.getSource().refresh();\n                        }\n                        if (layerType === 'wms') {\n                            let appliedOgcFilter;\n                            if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                    this.layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                    (this.dataSource.options as any).fieldNameGeometry,\n                                    undefined,\n                                    this.map.viewController.getOlProjection()\n                                );\n                            } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                            }\n                            (layerToApply.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(LinkedProperties.OGCFILTERS) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            const layerType = layer.ol.getProperties().sourceOptions.type;\n                            if (layerType === 'wfs') {\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                                layer.ol.getSource().refresh();\n                            }\n                            if (layerType === 'wms') {\n                                let appliedOgcFilter;\n                                if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                    appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                        layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                        (this.dataSource.options as any).fieldNameGeometry,\n                                        undefined,\n                                        this.map.viewController.getOlProjection()\n                                    );\n\n                                } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                    appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                                }\n                                (layer.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferTimeFilterProperties(timeFilter) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.TIMEFILTER) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const childLayer = this.map.layers.find(layer =>\n                        layer.dataSource instanceof WMSDataSource &&\n                        layer.options.linkedLayers?.linkId === linkedId);\n                    if (childLayer) {\n                        (childLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, false);\n                        const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                        (childLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers\n                .filter(layer => layer.dataSource instanceof WMSDataSource)\n                .map(parentLayer => {\n                    if (parentLayer.options.linkedLayers?.links) {\n                        parentLayer.options.linkedLayers.links.map(l => {\n                            if (l.properties && l.properties.indexOf(LinkedProperties.TIMEFILTER) !== -1 &&\n                                l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                                const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                                (parentLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                                (parentLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, true);\n                            }\n                        });\n                    }\n                });\n        }\n    }\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title,\n        url: legendUrl.url\n      });\n    }\n  }\n\n  return legends;\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|°]?\\\\s*([0-9]{1,2})?[:|\\'|′|’]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"|″|”]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees}° ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { LayerSyncWatcher } from '../../utils/layerSync-watcher';\nimport { Message, MessageService } from '@igo2/core';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value){\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter(m => m.options?.showOnEachLayerVisibility)\n        .map(message =>\n          this.showMessage(message)\n        );\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  private layerSyncWatcher: LayerSyncWatcher;\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.layerSyncWatcher = new LayerSyncWatcher(this, this.map);\n      this.layerSyncWatcher.subscribe(() => {});\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            this.showMessage(message);\n          });\n        }\n      });\n    } else {\n      this.layerSyncWatcher.unsubscribe();\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport FormatType from 'ol/format/FormatType';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    }\n    return vector;\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n          styleClone.getImage().setRadius(radius);\n          styleClone.getImage().setOpacity(opacity);\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const idAssociatedCall = (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (idAssociatedCall === (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter)\n        {\n            vectorSource.addFeatures(features);\n            success(features);\n        }\n        else {\n            success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === FormatType.ARRAY_BUFFER) {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === FormatType.JSON || type === FormatType.TEXT) {\n          source = xhr.responseText;\n        } else if (type === FormatType.XML) {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === FormatType.ARRAY_BUFFER) {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n}\n","export abstract class DataService {\n    abstract getData(): string;\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { BehaviorSubject } from 'rxjs';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(legendElement.contentType, legendElement.imageData);\n        label = legendElement.label ? legendElement.label.replace('<Null>', 'Null') : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === \"uniqueValue\") {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(legendElement.symbol.contentType, legendElement.symbol.imageData);\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === \"simple\") {\n      label = legendInfo.label ? legendInfo.label.replace('<Null>', 'Null') : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(legendInfo.symbol.contentType, legendInfo.symbol.imageData);\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string = `stroke:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\" `+ strokeDashArray + `/></svg>`;\n      }\n    } else if (symbol.style === 'esriSMSCircle' || symbol.style === 'esriSFSSolid') {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke = `stroke:rgba(` + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3] + ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill = `fill:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg = `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` + size/2 + `\" style=\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      } else {\n        svg = `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Feature Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any,\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (legend.layers) {\n      legendInfo = legend.layers.find(x => x.layerName === title);\n    } else if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend.layers.find(x => x.layerName === title) : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions>;\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            const title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            const message = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailable',\n              { value: context.params.LAYERS }\n            );\n\n            this.messageService.error(message, title);\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailableTitle'\n          );\n          const message = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailable',\n            { value: context.layer }\n          );\n\n          this.messageService.error(message, title);\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.layer }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\nimport { OptionsService } from './options.service';\nimport { OptionsApiOptions } from './options-api.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OptionsApiService extends OptionsService {\n  private urlApi: string;\n  private provideContextUri: boolean;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: OptionsApiOptions = {}\n  ) {\n    super();\n    this.urlApi = options.url || this.urlApi;\n    this.provideContextUri = options.provideContextUri || this.provideContextUri;\n  }\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions> {\n    if (!this.urlApi) {\n      return of({} as WMSDataSourceOptions);\n    }\n    let params = new HttpParams({\n      fromObject: {\n        type: baseOptions.type,\n        url: baseOptions.url,\n        layers: baseOptions.params.LAYERS\n      }\n    });\n\n    if (detailedContextUri && this.provideContextUri) {\n      params = params.append('context', detailedContextUri);\n    }\n\n    const request = this.http.get(this.urlApi, {\n      params\n    });\n\n    return request.pipe(\n      map(\n        (res: {\n          sourceOptions: WMSDataSourceOptions;\n          layerOptions: { [keys: string]: string };\n        }) => {\n          if (!res || !res.sourceOptions) {\n            return {} as WMSDataSourceOptions;\n          }\n          if (res.layerOptions) {\n            res.sourceOptions._layerOptionsFromSource = res.layerOptions;\n          }\n          return res.sourceOptions;\n        }\n      )\n    );\n  }\n\n\n  getArcgisRestOptions(\n    baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    if (!this.urlApi) {\n      return of({} as ArcGISRestImageDataSourceOptions);\n    }\n    let params = new HttpParams({\n      fromObject: {\n        type: baseOptions.type,\n        url: baseOptions.url,\n        layers: baseOptions.layer\n      }\n    });\n\n    if (detailedContextUri && this.provideContextUri) {\n      params = params.append('context', detailedContextUri);\n    }\n\n    const request = this.http.get(this.urlApi, {\n      params\n    });\n\n    return request.pipe(\n      map(\n        (res: {\n          sourceOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions;\n          layerOptions: { [keys: string]: string };\n        }) => {\n          if (!res || !res.sourceOptions) {\n            return {} as ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions;\n          }\n          if (res.layerOptions) {\n            res.sourceOptions._layerOptionsFromSource = res.layerOptions;\n          }\n          return res.sourceOptions;\n        }\n      )\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { OptionsService } from './options.service';\nimport { OptionsApiService } from './options-api.service';\n\nexport function optionsApiFactory(\n  http: HttpClient,\n  configService: ConfigService\n) {\n  return new OptionsApiService(\n    http,\n    configService.getConfig('optionsApi'),\n  );\n}\n\nexport function provideOptionsApi() {\n  return {\n    provide: OptionsService,\n    useFactory: optionsApiFactory,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), OlGeometryLayout.XY);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * We define the edge as 5% of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number]\n) {\n  const mapExtent = map.viewController.getExtent();\n  const edgeRatio = 0.05;\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(entitiesWithNoGeom, { inMapExtent: true }, false);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  let src;\n  if (isIE) {\n    switch (markerColor) {\n      case 'blue' || [0, 161, 222] || '#00a1de':\n        iconColor = 'blue';\n        break;\n      case 'red' || '#f64139':\n        iconColor = 'red';\n        break;\n      case 'yellow' || '#ffd700':\n        iconColor = 'yellow';\n        break;\n      case 'green' || '#008000':\n        iconColor = 'green';\n        break;\n      default:\n        iconColor = 'blue';\n        break;\n    }\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\n  } else {\n    src = svg;\n  }\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      imgSize: [36, 36], // for ie\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { StyleByAttribute } from './vector-style.interface';\n\nimport { ClusterParam } from './clusterParam';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olstyle.Style;\n\n  createStyle(options: { [key: string]: any }) {\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\n      return options;\n    }\n    return this.parseStyle('style', options);\n  }\n\n  private parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olstyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olstyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olstyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature: RenderFeature | OlFeature<OlGeometry>, styleByAttribute: StyleByAttribute) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label ? styleByAttribute.label.attribute : undefined;\n    let labelStyle = styleByAttribute.label?.style ? this.parseStyle('text', styleByAttribute.label.style) : undefined;\n    if (!labelStyle && label) {\n        labelStyle = new olstyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      labelStyle.setText(this.getLabel(feature, label));\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          if (icon) {\n            style = [\n              new olstyle.Style({\n                image: new olstyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              image: new olstyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olstyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olstyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 4,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n        typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olstyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olstyle.Circle;\n\n            if (r.showRange) {\n              const text = new olstyle.Text({\n                text: size.toString(),\n                fill: new olstyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: clusterRadius,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olstyle.Text({\n              text: size.toString(),\n              fill: new olstyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in degrees\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport olGeolocation from 'ol/Geolocation';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport olPoint from 'ol/geom/Point';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport olCircle from 'ol/geom/Circle';\nimport * as olstyle from 'ol/style';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public status$: Subject<SubjectStatus>;\n  public alwaysTracking: boolean;\n  public positionFollower: boolean = true;\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\n  public geolocationPositionFeature: olFeature<OlGeometry>;\n  public geolocationAccuracyFeature: olFeature<OlGeometry>;\n  public bufferGeom: olCircle;\n  public bufferFeature: olFeature<OlGeometry>;\n  public buffer: Overlay;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private geolocation: olGeolocation;\n  private geolocation$$: Subscription;\n\n  private options: MapOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(options?: MapOptions) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.buffer = new Overlay(this);\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    this.unsubscribeGeolocate();\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n\n      if (options.geolocate) {\n        this.geolocate(true);\n      }\n\n      if (options.alwaysTracking) {\n        this.alwaysTracking = true;\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => (layer.ol as any).ol_uid && (layer.ol as any).ol_uid === olUId\n    );\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          layersToRemove.push(linkedLayer);\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    const linkedLayers = srcLayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.syncedDelete) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            layersToRemove.push(layerToApply);\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(layer => {\n        if (layer.options.linkedLayers?.links) {\n          layer.options.linkedLayers.links.map(l => {\n            if (\n              l.syncedDelete && l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersToRemove.push(layer);\n              this.handleLinkedLayersDeletion(layer, layersToRemove);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n\n  // TODO: Create a GeolocationController with everything below\n  geolocate(track = false) {\n    let first = true;\n    if (this.geolocation$$) {\n      track = this.geolocation.getTracking();\n      this.unsubscribeGeolocate();\n    }\n    this.startGeolocation();\n\n    this.geolocation$$ = this.geolocation$.subscribe((geolocation) => {\n      if (!geolocation) {\n        return;\n      }\n      const accuracy = geolocation.getAccuracy();\n      const coordinates = geolocation.getPosition();\n      if (accuracy < 10000) {\n        const positionGeometry = coordinates ? new olPoint(coordinates) : null;\n\n        const accuracyGeometry = geolocation.getAccuracyGeometry();\n        const accuracyExtent = accuracyGeometry.getExtent();\n\n        [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n          if (feature && this.overlay.dataSource.ol.getFeatureById(feature.getId())) {\n            this.overlay.dataSource.ol.removeFeature(feature);\n          }\n        });\n\n        if (this.bufferFeature) {\n          this.buffer.dataSource.ol.removeFeature(this.bufferFeature);\n        }\n\n        this.geolocationPositionFeature = new olFeature({ geometry: positionGeometry });\n        this.geolocationPositionFeature.setId('geolocationPositionFeature');\n\n        this.geolocationPositionFeature.setStyle(\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 6,\n              fill: new olstyle.Fill({\n                color: '#3399CC',\n              }),\n              stroke: new olstyle.Stroke({\n                color: '#fff',\n                width: 2,\n              }),\n            }),\n          })\n        );\n\n\n        this.geolocationAccuracyFeature = new olFeature({ geometry: accuracyGeometry });\n        this.geolocationAccuracyFeature.setId('geolocationAccuracyFeature');\n        if (this.alwaysTracking) {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature,\n              this.positionFollower ? FeatureMotion.Move : FeatureMotion.None\n            );\n          });\n\n        } else {\n          [this.geolocationPositionFeature, this.geolocationAccuracyFeature].map(feature => {\n            this.overlay.addOlFeature(\n              feature\n            );\n          });\n        }\n\n        if (this.ol.getView().get('options_')?.buffer) {\n          const bufferRadius = this.ol.getView().get('options_').buffer.bufferRadius;\n          this.bufferGeom = new olCircle(coordinates, bufferRadius);\n          const bufferStroke = this.ol.getView().get('options_').buffer.bufferStroke;\n          const bufferFill = this.ol.getView().get('options_').buffer.bufferFill;\n\n          let bufferText;\n          if (this.ol.getView().get('options_').buffer.showBufferRadius) {\n            bufferText = bufferRadius.toString() + 'm';\n          } else {\n            bufferText = '';\n          }\n\n          this.bufferFeature = new olFeature(this.bufferGeom);\n          this.bufferFeature.setId('bufferFeature');\n          this.bufferFeature.set('bufferStroke', bufferStroke);\n          this.bufferFeature.set('bufferFill', bufferFill);\n          this.bufferFeature.set('bufferText', bufferText);\n          this.buffer.addOlFeature(this.bufferFeature, FeatureMotion.None);\n        }\n        if (first) {\n          this.viewController.zoomToExtent(accuracyExtent as [number, number, number, number]);\n          this.positionFollower = !this.positionFollower;\n        }\n      } else if (first) {\n        const view = this.ol.getView();\n        view.setCenter(coordinates);\n        view.setZoom(14);\n      }\n      if (track !== true && this.alwaysTracking !== true) {\n        this.unsubscribeGeolocate();\n      }\n      first = false;\n    });\n  }\n\n  unsubscribeGeolocate() {\n    this.stopGeolocation();\n    if (this.geolocation$$) {\n      this.geolocation$$.unsubscribe();\n      this.geolocation$$ = undefined;\n    }\n  }\n\n  private startGeolocation() {\n    if (!this.geolocation) {\n      this.geolocation = new olGeolocation({\n        trackingOptions: {\n          enableHighAccuracy: true\n        },\n        projection: this.projection,\n        tracking: true\n      });\n\n      this.geolocation.on('change', (evt) => {\n        this.geolocation$.next(this.geolocation);\n      });\n    } else {\n      this.geolocation.setTracking(true);\n    }\n  }\n\n  private stopGeolocation() {\n    if (this.geolocation) {\n      this.geolocation.setTracking(false);\n    }\n  }\n\n  onOfflineToggle(offline: boolean) {\n    this.offlineButtonToggle$.next(offline);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import { Directive, AfterViewInit } from '@angular/core';\nimport {\n  NetworkService,\n  ConnectionState,\n  MessageService,\n  LanguageService\n} from '@igo2/core';\n\nimport { IgoMap } from './map';\nimport { MapBrowserComponent } from '../map-browser/map-browser.component';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { XYZDataSourceOptions } from '../../datasource/shared/datasources/xyz-datasource.interface';\nimport { MVTDataSourceOptions } from '../../datasource/shared/datasources/mvt-datasource.interface';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { MVTDataSource } from '../../datasource/shared/datasources/mvt-datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { XYZDataSource } from '../../datasource/shared/datasources/xyz-datasource';\n\n@Directive({\n  selector: '[igoMapOffline]'\n})\nexport class MapOfflineDirective implements AfterViewInit {\n  private component: MapBrowserComponent;\n  private offlineButtonStatus: boolean = false;\n  private networkState: ConnectionState = {\n    connection: true\n  };\n  private offlineButtonState: ConnectionState = {\n    connection: true\n  };\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  private previousMessageId;\n\n  constructor(\n    component: MapBrowserComponent,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {\n    this.component = component;\n  }\n\n  ngAfterViewInit() {\n    this.map.offlineButtonToggle$.subscribe((offlineButtonToggle: boolean) => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.offlineButtonStatus = offlineButtonToggle;\n      const translate = this.languageService.translate;\n      if (this.offlineButtonStatus && this.networkState.connection) {\n        const message = translate.instant('igo.geo.network.offline.message');\n        const title = translate.instant('igo.geo.network.offline.title');\n        const messageObj = this.messageService.info(message, title);\n        this.previousMessageId = messageObj.toastId;\n        this.offlineButtonState.connection = false;\n        this.changeLayer();\n      } else if (!this.offlineButtonStatus && !this.networkState.connection) {\n        const message = translate.instant('igo.geo.network.offline.message');\n        const title = translate.instant('igo.geo.network.offline.title');\n        const messageObj = this.messageService.info(message, title);\n        this.previousMessageId = messageObj.toastId;\n        this.offlineButtonState.connection = false;\n        this.changeLayer();\n      } else if (!this.offlineButtonStatus && this.networkState.connection) {\n        let message;\n        let title;\n        const messageObs = translate.get('igo.geo.network.online.message');\n        const titleObs = translate.get('igo.geo.network.online.title');\n        messageObs.subscribe((message1: string) => {\n          message = message1;\n        });\n        titleObs.subscribe((title1: string) => {\n          title = title1;\n        });\n        if (message) {\n          const messageObj = this.messageService.info(message, title);\n          this.previousMessageId = messageObj.toastId;\n        }\n        this.offlineButtonState.connection = true;\n        this.changeLayer();\n      }\n    });\n\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkState = state;\n      if (!this.offlineButtonStatus) {\n        this.changeLayer();\n      }\n    });\n\n    this.map.layers$.subscribe((layers: Layer[]) => {\n      this.changeLayer();\n    });\n  }\n\n  private changeLayer() {\n    let sourceOptions;\n    const layerList = this.map.layers$.value;\n    layerList.forEach(layer => {\n      if (layer.isIgoInternalLayer) {\n        return;\n      }\n      if (layer.options.source instanceof MVTDataSource) {\n        sourceOptions = layer.options.sourceOptions as MVTDataSourceOptions;\n        layer.ol.getSource().refresh();\n      } else if (layer.options.source instanceof XYZDataSource) {\n        sourceOptions = layer.options.sourceOptions as XYZDataSourceOptions;\n      } else if (layer.options.source instanceof ClusterDataSource) {\n        sourceOptions = layer.options.sourceOptions as ClusterDataSourceOptions;\n      } else if (layer.options.source instanceof FeatureDataSource) {\n        sourceOptions = layer.options.sourceOptions as FeatureDataSourceOptions;\n      } else {\n        if (\n          this.networkState.connection === false ||\n          this.offlineButtonState.connection === false\n        ) {\n          layer.ol.setMaxResolution(0);\n          return;\n        } else if (\n          this.networkState.connection === true ||\n          this.offlineButtonState.connection === true\n        ) {\n          layer.ol.setMaxResolution(Infinity);\n          return;\n        }\n      }\n\n      if (sourceOptions) {\n        if (\n          (sourceOptions.pathOffline &&\n            this.networkState.connection === false) ||\n          (sourceOptions.pathOffline &&\n            this.offlineButtonState.connection === false)\n        ) {\n          if (\n            sourceOptions.type === 'vector' ||\n            sourceOptions.type === 'cluster'\n          ) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(sourceOptions.pathOffline);\n        } else if (\n          (sourceOptions.pathOffline &&\n            this.networkState.connection === false) ||\n          (sourceOptions.pathOffline &&\n            this.offlineButtonState.connection === true)\n        ) {\n          if (\n            sourceOptions.type === 'vector' ||\n            sourceOptions.type === 'cluster'\n          ) {\n            return;\n          }\n          (layer.ol.getSource() as any).setUrl(sourceOptions.url);\n        } else {\n          if (\n            this.networkState.connection === false ||\n            this.offlineButtonState.connection === false\n          ) {\n            layer.ol.setMaxResolution(0);\n          } else if (\n            this.networkState.connection === true ||\n            this.offlineButtonState.connection === true\n          ) {\n            layer.ol.setMaxResolution(Infinity);\n          }\n        }\n      } else {\n        if (\n          this.networkState.connection === false ||\n          this.offlineButtonState.connection === false\n        ) {\n          layer.ol.setMaxResolution(0);\n        } else if (\n          this.networkState.connection === true ||\n          this.offlineButtonState.connection === true\n        ) {\n          layer.ol.setMaxResolution(Infinity);\n        }\n      }\n    });\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { LanguageService, MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    private languageService: LanguageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService, languageService: LanguageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(languageService.translate.instant(\n          'igo.geo.dataSource.optionsApiUnavailable'\n        ),\n        languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        ));\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core'\n  ;\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> = new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], { map: this.map });\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarker\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: \"vector\",\n      declutter: true,\n      source: new olVectorTileSource({}),\n      style: (feature) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(feature, this.mvtStyleOptions);\n        }\n      }\n    });\n  }\n\n  createHoverStyle(feature: RenderFeature | OlFeature<OlGeometry>, hoverStyle: StyleByAttribute) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style =\n      {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(feature, localHoverStyle);\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: OlFeature<OlGeometry>[]) {\n\n    this.addFeatureOverlay(resultsUnderPointerPosition);\n\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    this.clearLayer();\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (!layerOL) {\n          return;\n        }\n        const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n        if (!this.canProcessHover(igoLayer as any)) {\n          return;\n        }\n        if (igoLayer.zIndex <= maximumZindex) {\n          return;\n        }\n        maximumZindex = igoLayer.zIndex;\n        topMostOlLayer = layerOL;\n\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer instanceof olLayerVector || olLayer instanceof olLayerVectorTile\n      });\n      if (!topMostOlLayer) {\n        return;\n      }\n\n      this.clearLayer();\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (mapFeature.get('hoverSummary') === undefined) {\n          let igoLayer;\n          if (layerOL instanceof olLayerVector) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            let localOlFeature = this.handleRenderFeature(mapFeature);\n            this.setLayerStyleFromOptions(igoLayer, localOlFeature);\n            const featuresToLoad = [localOlFeature];\n            localOlFeature.set(\"_isLabel\", false);\n            const myLabelOlFeature = new OlFeature();\n            myLabelOlFeature.setProperties(localOlFeature.getProperties());\n            const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n            myLabelOlFeature.setGeometry(labelGeom);\n            myLabelOlFeature.setId(localOlFeature.getId());\n            myLabelOlFeature.set(\"_isLabel\", true);\n            this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n            featuresToLoad.push(myLabelOlFeature);\n            this.pointerHoverFeatureStore.load(featuresToLoad);\n            return true;\n          }\n          if (layerOL instanceof olLayerVectorTile) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorTileLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.styleByAttribute.hoverStyle;\n            } else if (igoLayer?.options?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.hoverStyle;\n            }\n            this.selectionLayer.setSource(layerOL.getSource());\n            layerOL.getFeatures(event.pixel).then((mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n              if (!mvtFeatures.length) {\n                this.selectionMVT = {};\n                this.selectionLayer.changed();\n                this.clearLayer();\n                return;\n              }\n              const feature = mvtFeatures[0];\n              if (!feature) {\n                this.clearLayer();\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(feature);\n              localOlFeature.set(\"_isLabel\", false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set(\"_isLabel\", true);\n              this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n              this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n              this.selectionMVT[feature.getId()] = localOlFeature;\n              this.selectionLayer.changed();\n            });\n          }\n        }\n        return true;\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer === topMostOlLayer\n      });\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (!igoLayer.options.styleByAttribute && !igoLayer.options.hoverStyle) {\n      return false;\n    }\n\n    if (\n      (igoLayer.options.styleByAttribute && !igoLayer.options.styleByAttribute.hoverStyle) &&\n      !igoLayer.options.hoverStyle) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(feature: RenderFeature | OlFeature<OlGeometry>): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n\n    if (hoverEntity.length > 0) {\n\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer | VectorTileLayer, feature: OlFeature<OlGeometry>) {\n    if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.styleByAttribute.hoverStyle));\n      return;\n    }\n    if (igoLayer?.options?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.hoverStyle));\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarker(feature: OlFeature<OlGeom.Geometry>, resolution: number): OlStyle.Style[] {\n\n  const olStyleText = new OlStyle.Style({\n    text: new OlStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new OlStyle.Fill({ color: '#000' }),\n      backgroundFill: new OlStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new OlStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new OlStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n\n  const olStyle = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyle.push(new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: 10,\n          stroke: new OlStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      }));\n      break;\n    default:\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'white',\n          width: 5\n        })\n      }));\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'blue',\n          width: 3\n        })\n      }));\n  }\n\n  return olStyle;\n\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-menu-button',\n  templateUrl: './menu-button.component.html',\n  styleUrls: ['./menu-button.component.scss']\n})\nexport class MenuButtonComponent {\n\n  @Input()\n  get sidenavOpened(): boolean {\n    return this._sidenavOpenend;\n  }\n  set sidenavOpened(value: boolean) {\n    this._sidenavOpenend = value;\n    this.getClassMenuButton();\n  }\n  private _sidenavOpenend: boolean;\n\n  @Output() openSidenav = new EventEmitter<any>();\n\n  public menuButtonReverseColor = false;\n\n  public menuButtonClass;\n\n  constructor(public configService: ConfigService) {\n    if (\n      typeof this.configService.getConfig('menuButtonReverseColor') !==\n      'undefined'\n    ) {\n      this.menuButtonReverseColor = this.configService.getConfig(\n        'menuButtonReverseColor'\n      );\n    }\n  }\n\n  getClassMenuButton() {\n    if (this.sidenavOpened) {\n      this.menuButtonClass = {\n        'menu-button': this.menuButtonReverseColor === false,\n        'menu-button-reverse-color': this.menuButtonReverseColor === true\n      };\n    } else {\n      this.menuButtonClass = {\n        'menu-button': this.menuButtonReverseColor === false,\n        'menu-button-reverse-color-close': this.menuButtonReverseColor === true\n      };\n    }\n  }\n\n  onToggleSidenavClick() {\n    this.openSidenav.emit();\n  }\n}\n","<button\n    mat-icon-button\n    id= \"menu-button\"\n    [ngClass]=\"menuButtonClass\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"(sidenavOpened ? 'menu.close' : 'menu.open') | translate\"\n    (click)=\"onToggleSidenavClick()\">\n    <mat-icon svgIcon=\"menu\"></mat-icon>\n</button>\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor() {}\n}\n","<div class=\"igo-geolocate-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.geolocate' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"map.geolocate()\">\n    <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n  </button>\n</div>\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl:'./home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss'],\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n constructor(public configService: ConfigService) {\r\n      this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent = this.extentOverride || this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter = this.centerOverride || this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom = this.zoomOverride || this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(this.homeExtentButtonCenter, this.map.viewController.olView.getProjection().getCode());\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\"><button\r\n      mat-icon-button\r\n      [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n            matTooltipPosition=\"left\"\r\n      [color]=\"color\"\r\n      (click)=\"onToggleClick()\"><mat-icon svgIcon = \"home-map-marker\"></mat-icon></button></div>\r\n","<div *ngIf=\"visible\" class=\"igo-user-button-container\">\n  <div>\n    <button\n      mat-icon-button\n      [matTooltip]=\"checked ? ('igo.geo.mapButtons.online' | translate): ('igo.geo.mapButtons.offline' | translate)\"\n      matTooltipPosition=\"left\"\n      [ngClass]=\"[btnStyle]\"\n      [color]=\"checked ? color : [colorOff]\"\n      (click)=\"onToggle()\"\n      (click)=\"map.onOfflineToggle(check)\">\n      <mat-icon svgIcon=\"wifi-strength-off\"></mat-icon>\n    </button>\n  </div>\n</div>","import { Component, Input, EventEmitter, Output } from '@angular/core';\nimport { IgoMap } from '../shared/map';\nimport { ConfigService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-offline-button',\n  templateUrl: './offline-button.component.html',\n  styleUrls: ['./offline-button.component.scss']\n})\n\nexport class OfflineButtonComponent {\n\n  btnStyle: string = 'baseStyle';\n  colorOff: string = 'rgb(255,255,255)';\n\n  @Output() change = new EventEmitter<boolean>();\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  @Input() public check: boolean = false;\n\n  get checked(): boolean {\n    return this.check;\n  }\n\n  public visible = false;\n\n  constructor(\n    private config: ConfigService\n    ) {\n    this.visible = this.config.getConfig('offlineButton') ? true : false;\n  }\n\n  onToggle() {\n    this.check = !this.check;\n    if (this.check) {\n      this.btnStyle = 'toggleStyle';\n    } else {\n      this.btnStyle = 'baseStyle';\n    }\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport stylefunction from 'ol-mapbox-style/dist/stylefunction';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Style } from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from './style.service';\nimport { LanguageService, MessageService } from '@igo2/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(_layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style;\n    let igoLayer: VectorLayer;\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.clusterBaseStyle;\n      layerOptions.style = feature => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style;\n    let igoLayer: VectorTileLayer;\n\n    if (layerOptions.style !== undefined) {\n      style = this.styleService.createStyle(layerOptions.style);\n    }\n\n    if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = feature => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute\n        );\n      };\n      igoLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.mapboxStyle) {\n      this.getMapboxGlStyle(layerOptions.mapboxStyle.url).subscribe(res => {\n        stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\n      });\n    }\n  }\n\n  public getMapboxGlStyle(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef\n} from '@angular/core';\n\nimport { Layer, LayerOptions } from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() display: boolean;\n  @Input() title: string;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) { }\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer) {\n    const linkedLayers = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\n      // search for child layers\n      currentLinks.map(link => {\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            const linkedLayerOptions: any = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible: true,\n                baseLayer: false,\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"rotated && !showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get showIfNoRotation(): boolean {\n    return this._showIfNoRotation;\n  }\n  set showIfNoRotation(value: boolean) {\n    this._showIfNoRotation = value;\n  }\n  private _showIfNoRotation: boolean;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  get rotated(): boolean {\n    return this.map.viewController.getRotation() !== 0;\n  }\n\n  constructor() {}\n\n  rotationStyle(radians): {} {\n    const rotation = 'rotate(' + radians + 'rad)';\n    return {\n      transform: rotation\n    };\n  }\n}\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared/map';\nimport { getRenderPixel } from 'ol/render';\nimport { Subscription } from 'rxjs';\n\n/**\n * Tool to swipe the layers\n */\n@Component({\n  selector: 'igo-swipe-control',\n  templateUrl: './swipe-control.component.html',\n  styleUrls: ['./swipe-control.component.scss']\n})\n\nexport class SwipeControlComponent implements AfterViewInit, OnDestroy {\n\n\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The list of layers for swipe\n   */\n  private layers: Layer[];\n\n  /**\n   * Final position of the swiped element\n   */\n  private pos1: number;\n\n  /**\n   * Intermediate position of the swiped element\n   */\n  private pos3: number;\n\n  /**\n   * State of draggable action\n   */\n  private inDragAction: boolean = false;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private swipeEnabled$$: Subscription;\n\n  /**\n   * Binder of prerender on the same element\n   */\n  private boundPrerender = this.prerender.bind(this);\n\n  constructor() {\n   }\n\n  /**\n   * Get the list of layers for swipe and activate of deactivate the swipe\n   * @internal\n   */\n  ngAfterViewInit(): void {\n    this.getListOfLayers();\n    this.swipeEnabled$$ = this.map.swipeEnabled$.subscribe(value => {\n        value ? this.displaySwipe() : this.displaySwipeOff();\n      });\n    this.letZoom();\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy(): void {\n    this.swipeEnabled$$.unsubscribe();\n    this.map.swipeEnabled$.unsubscribe();\n    this.displaySwipeOff();\n  }\n\n  /**\n   * Display a swipe-element and render the layers\n   */\n  displaySwipe() {\n    this.swipeId.style.visibility = 'visible';\n    this.layers.map(layer => layer.ol.on('prerender', this.boundPrerender));\n    this.layers.map(layer => layer.ol.on('postrender', this.postrender));\n    this.map.ol.render();\n  }\n\n  /**\n   * Clear a swipe-element and render the layers on the initial state\n   */\n  displaySwipeOff() {\n    this.swipeId.style.visibility = 'hidden';\n    this.layers.map(layer => layer.ol.un('prerender', this.boundPrerender));\n    this.layers.map(layer => layer.ol.un('postrender', this.postrender));\n    this.map.ol.render();\n    this.layers = [];\n  }\n\n  /**\n   * Getter of element\n   */\n  get swipeId() {\n    return document.getElementById('igo-layer-swipe');\n  }\n\n  /**\n   * Get the list of layers for swipe\n   */\n  getListOfLayers() {\n    this.map.selectedFeatures$.subscribe(layers => {\n      this.layers = [];\n      if (layers !== null) {\n        for (const layer of layers) {\n          if (!this.layers.includes(layer)) {\n            this.layers.push(layer);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Get a position of click or touch\n   */\n  dragDown(event) {\n    this.inDragAction = true;\n    event.preventDefault();\n    if (event.type === 'mousedown'){\n        this.pos3 = event.clientX;\n        this.mouseSwipe();\n        document.onmouseup = this.closeDragMouseElement;\n    }\n    else if (event.type === 'touchstart'){\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos3 = event.touches[0].clientX;\n        this.touchSwipe();\n        document.ontouchend = this.closeDragTouchElement;\n    }\n  }\n\n  /**\n   * Moving a line with a mouse\n   */\n  mouseSwipe(){\n    document.addEventListener('mousemove', event => {\n      if (this.inDragAction){\n        event.preventDefault();\n        this.pos1 = this.pos3 - event.clientX;\n        this.pos3 = event.clientX;\n        this.swipeId.style.left = (this.swipeId.offsetLeft - this.pos1) + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Moving a line with a touch\n   */\n  touchSwipe(){\n    document.addEventListener('touchmove', event => {\n      if (this.inDragAction) {\n        event.preventDefault();\n        document.getElementById('arrows').style.visibility = 'hidden';\n        this.pos1 = this.pos3 - event.changedTouches[0].clientX;\n        this.pos3 = event.changedTouches[0].clientX;\n        this.swipeId.style.left = (this.swipeId.offsetLeft - this.pos1) + 'px';\n      }\n      this.map.ol.render();\n    });\n  }\n\n  /**\n   * Deactivate a listener of a mouse-action\n   */\n  closeDragMouseElement() {\n    document.onmouseup = null;\n    document.onmousemove = null;\n    this.inDragAction = false;\n  }\n\n  /**\n   * Deactivate a listener of a touch-action\n   */\n  closeDragTouchElement() {\n    document.ontouchend = null;\n    document.ontouchmove = null;\n    document.getElementById('arrows').style.visibility = 'visible';\n    this.inDragAction = false;\n  }\n\n  /**\n   * Cut the image of a layer by the position of swiped-element\n   */\n  prerender(event) {\n      const ctx = event.context;\n      const mapSize = this.map.ol.getSize();\n      const width = this.swipeId.offsetLeft ;\n      const tl = getRenderPixel(event, [width, 0]);\n      const tr = getRenderPixel(event, [0, 0]);\n      const bl = getRenderPixel(event, [width, mapSize[1]]);\n      const br = getRenderPixel(event, [0, mapSize[1]]);\n      ctx.save();\n      ctx.beginPath();\n      ctx.moveTo(tl[0], tl[1]);\n      ctx.lineTo(bl[0], bl[1]);\n      ctx.lineTo(br[0], br[1]);\n      ctx.lineTo(tr[0], tr[1]);\n      ctx.closePath();\n      ctx.clip();\n  }\n\n  /**\n   * Save a current state of the context\n   */\n  postrender(event){\n    event.context.restore();\n    event.context.save();\n  }\n\n  /**\n   * Zoom on div\n   */\n     private letZoom() {\n      document.getElementById('igo-layer-swipe').addEventListener('wheel', event => {\n        event.deltaY > 0 ? this.map.viewController.zoomOut() : this.map.viewController.zoomIn();\n      }, true);\n    }\n}\n","<div class=\"igo-swipe-control-container\"  id=\"igo-layer-swipe\"\n  (mousedown)=\"dragDown($event)\"\n  (mouseup)=\"closeDragMouseElement()\"\n  (touchstart)=\"dragDown($event)\"\n  (touchend)=\"closeDragTouchElement()\">\n  <div class=\"igo-swipe-control-line\" ></div>\n  \n  <div class=\"igo-swipe-control-arrows\" id=\"arrows\">\n    <div class=\"igo-arrow-left\"></div>\n    <div class=\"igo-arrow-right\"></div>\n  </div>\n</div>\n","import { AfterViewInit, Component, Input, OnDestroy } from '@angular/core';\nimport { IgoMap } from '../shared/map';\nimport { Subscription } from 'rxjs';\n\n/**\n * Tool to display the center of the map\n */\n@Component({\n  selector: 'igo-map-center',\n  templateUrl: './map-center.component.html',\n  styleUrls: ['./map-center.component.scss']\n})\n\nexport class MapCenterComponent implements AfterViewInit, OnDestroy {\n\n  /**\n   * Get an active map\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Listener of toggle from advanced-map-tool\n   */\n  private displayCenter$$: Subscription;\n  constructor() { }\n\n  /**\n   * Set a visibility for cursor of the center of the map\n   */\n  ngAfterViewInit() {\n    if (this.map) {\n      this.displayCenter$$ = this.map.mapCenter$.subscribe(value => {\n        value ?\n          document.getElementById('mapCenter').style.visibility = 'visible' :\n          document.getElementById('mapCenter').style.visibility = 'hidden';\n      });\n    }\n    this.letZoom();\n  }\n\n  /**\n   * Destroyer of a component\n   */\n  ngOnDestroy() {\n    if (this.displayCenter$$) {\n      this.displayCenter$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Zoom on div\n   */\n  private letZoom() {\n    document.getElementById('mapCenter').addEventListener('wheel', event => {\n      event.deltaY > 0 ? this.map.viewController.zoomOut() : this.map.viewController.zoomIn();\n    }, true);\n  }\n}\n","<div\n    class=\"mapCenter\"\n    id=\"mapCenter\">\n    <div class=\"vertical\"></div>\n    <div class=\"horizontal\"></div>\n</div>\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n    <pre>{{infoContent}}</pre>\n</div>","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n\n  @Input() infoContent: string = '';\n\n  constructor() {}\n\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport * as striptags_ from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { uuid } from '@igo2/utils';\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n\n  constructor(private http: HttpClient) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    return layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\n        mergeMap(gmlRes => {\n          const mergedGML = this.mergeGML(gmlRes, url, layer);\n          const imposedGeom = mergedGML[0];\n          const imposedProperties = mergedGML[1];\n          return this.http\n            .get(url, { responseType: 'text' })\n            .pipe(\n              map(res =>\n                this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n              )\n            );\n        })\n      );\n    }\n\n    const request = this.http.get(url, { responseType: 'text' });\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\n  }\n\n  private mergeGML(gmlRes, url, layer: Layer): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map(feature => {\n\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent ? queryTitleContent : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n      case 'Point':\n        return olmpts;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [ returnGeometry, imposedProperties];\n\n\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n\n    if (features.length > 0 && features[0].geometry === null) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const striptags = striptags_;\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign({ target: htmlTarget, body: res, url }, imposedProperties),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.the_geom;\n    delete properties.geom;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string {\n    let url;\n\n    if (datasource.options.queryUrl) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || '5'\n        };\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): string {\n\n      let url = datasource.options.queryUrl.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n      .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n      .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n      .replace(/\\{ymax\\}/g, mapExtent[3].toString())\n      .replace(/\\{x\\}/g, options.coordinates[0].toString())\n      .replace(/\\{y\\}/g, options.coordinates[1].toString())\n      .replace(/\\{resolution\\}/g, options.resolution.toString())\n      .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''));\n\n      return url;\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined ? (dataSource.options.queryLayerFeatures === true) : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if ((layer.dataSource.options as QueryableDataSourceOptions).queryFormatAsWms) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-z]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { createOverlayMarkerStyle } from '../overlay/shared/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/shared/overlay.utils';\nimport { FeatureCommonVectorStyleOptions } from './commonVectorStyle.interface';\nimport { Feature } from '../feature';\n\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 1,\n    markerOutlineColor = [0, 255, 255],\n    fillColor,\n    fillOpacity = 0.15,\n    strokeColor = [0, 255, 255],\n    strokeOpacity = 0.5,\n    strokeWidth = 4\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 0.5,\n    markerOutlineColor,\n    fillColor = [0, 161, 222],\n    fillOpacity = 0.15,\n    strokeColor = [0, 161, 222],\n    strokeOpacity = 0.5,\n    strokeWidth = 2\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (markerColorAsArray.length === 4 &&\n        (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (!(fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' || /^#[0-9A-F]{8}$/i.test(fillColor as string)))) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (!(strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' || /^#[0-9A-F]{8}$/i.test(strokeColor as string)))) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is keep\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            const nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          const message =\n          catalog.title ? this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: catalog.title }\n          ) : this.languageService.translate.instant(\n            'igo.geo.catalog.someUnavailable'\n          );\n\n          this.messageService.error(message, title);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    let layerTitle;\n    if (catalog.forcedProperties) {\n      for (const property of catalog.forcedProperties) {\n        if (layer.Name === property.layerName && property.title) {\n          layerTitle = property.title;\n        }\n      }\n    }\n\n    let abstract;\n    if (layer.Abstract) {\n      abstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      abstract = catalog.abstract;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: layerTitle !== undefined ? layerTitle : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.Title === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n          return undefined;\n        }\n        const params = Object.assign({}, catalog.queryParams, {\n          version: '1.0.0'\n        });\n        const baseSourceOptions = {\n          type: 'wmts',\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.Identifier,\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          requestEncoding: catalog.requestEncoding || 'KVP',\n          style: 'default'\n        } as WMTSDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions,\n          { params }\n        ) as WMTSDataSourceOptions;\n\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.Title,\n          address: catalog.id,\n          externalProvider: catalog.externalProvider,\n          options: {\n            sourceOptions,\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract: catalog.abstract,\n              type: baseSourceOptions.type\n            }\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers =\n    !capabilities.layers ? [] : capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    if (!capabilities.layers) {\n      this.messageService.error(\n        this.languageService.translate.instant('igo.geo.catalog.someUnavailable'),\n        this.languageService.translate.instant('igo.geo.catalog.unavailableTitle')\n      );\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n        let forcedTitle;\n        if (catalog.forcedProperties) {\n          for (const property of catalog.forcedProperties) {\n            if (layer.name === property.layerName && property.title) {\n              forcedTitle = property.title;\n            }\n          }\n        }\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: forcedTitle !== undefined ? forcedTitle : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: undefined,\n              extern: undefined,\n              abstract,\n              type: baseSourceOptions.type\n            },\n            title: forcedTitle !== undefined ? forcedTitle : layer.name\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer) {\n    this.addLayersToMap([layer]);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[]) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(oLayers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const oLayer = this.map.getLayerById(layer.options.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      } else {\n        const oLayer = this.map.getLayerById(layer.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                src=\"{{[item.imgGraphValue]}}\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http);\n      secureIMG.transform(item.url).pipe(\n        catchError((err) => {\n          if (err.error) {\n            err.error.caught = true;\n            this.getLegend = false;\n            this.cdRef.detectChanges();\n            return err;\n          }\n        })\n        ).subscribe(obsLegGraph => {\n          const idx = this.legendItems$.value.findIndex(leg => leg.title === item.title);\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        }\n      );\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       igoMatBadgeIcon=\"eye-off\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"isInResolutionsRange()\"\n       matBadgeDisabled=\"true\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isInResolutionsRange();\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(): boolean {\n    const minResolution = this.layer.options.minResolution || 0;\n    const maxResolution = this.layer.options.maxResolution || Infinity;\n    this.inRange$.next(\n      this.resolution >= minResolution && this.resolution <= maxResolution\n    );\n    return this.inRange$.value;\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.isPreview$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    group: CatalogItemGroup;\n  }>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick() {\n    this.added$.value ? this.remove() : this.add();\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove() {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add() : this.remove();\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"layersChecked.length !== 0 && activeLayersAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties, LayersLink } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerIsValid(layer: Layer): boolean {\n    let valid = false;\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange ){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement) {\n    const layersToMove = [activeLayer];\n    const sortedLayersToMove = [];\n    this.getLinkedLayers(activeLayer, layersToMove);\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, false);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, false);\n    }\n  }\n\n  private getLinkedLayers(activeLayer: Layer, layersList: Layer[]) {\n    const linkedLayers = activeLayer.options.linkedLayers as LayersLink;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.properties || link.properties.indexOf(LinkedProperties.ZINDEX) === -1) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const childLayer = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (childLayer) {\n            if (!layersList.includes(childLayer)) {\n              layersList.push(childLayer);\n            }\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(parentLayer => {\n        if (parentLayer.options.linkedLayers?.links) {\n          parentLayer.options.linkedLayers.links.map(l => {\n            if (\n              l.properties?.indexOf(LinkedProperties.ZINDEX) !== -1 &&\n              l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersList.push(parentLayer);\n              this.getLinkedLayers(parentLayer, layersList);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef();\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop = elements[1].offsetParent.offsetTop;\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef('lower');\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop =\n            elements[1].offsetParent.offsetTop +\n            elements[1].offsetParent.offsetHeight -\n            elements[0].clientHeight;\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  computeElementRef(type?: string) {\n    const checkItems = this.elRef.nativeElement.getElementsByClassName(\n      'mat-checkbox-checked'\n    );\n    const checkItem =\n      type === 'lower'\n        ? this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[checkItems.length - 1]\n        : this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[0];\n    const igoList = this.elRef.nativeElement.getElementsByTagName(\n      'igo-list'\n    )[0];\n\n    return [igoList, checkItem];\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { Layer } from '../shared/layers/layer';\nimport { debounceTime } from 'rxjs/operators';\nimport { LayerLegendListComponent } from './layer-legend-list.component';\n\n@Directive({\n  selector: '[igoLayerLegendListBinding]'\n})\nexport class LayerLegendListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerLegendListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerLegendListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n\n      this.layersVisibility$$ = combineLatest(shownLayers\n        .map((layer: Layer) => layer.visible$))\n        .subscribe((r) => {\n          this.component.change$.next();\n        }\n        );\n    });\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from './shared/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: FormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      const title = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.title'\n      );\n      const message = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.message'\n      );\n      this.messageService.alert(message, title);\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant('igo.geo.catalog.unavailableTitle');\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          const message = this.languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url });\n          this.messageService.error(message, title);\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\n@NgModule({\n  imports: [],\n  exports: [],\n  declarations: []\n})\nexport class IgoDataSourceModule {\n  static forRoot(): ModuleWithProviders<IgoDataSourceModule> {\n    return {\n      ngModule: IgoDataSourceModule,\n      providers: []\n    };\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  open(layer: Layer) {\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.download.title');\n    this.messageService.success(\n      translate.instant('igo.geo.download.start'),\n      title\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key }}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\">\n          <img *ngIf=\"isImg(property.value);else notImg\" src=\"{{(property.value | secureImage) | async}}\" width=\"225\" heigth=\"auto\">\n          <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { userAgent } from '@igo2/utils';\nimport { NetworkService, ConnectionState } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].includes(value.split('.').pop().toLowerCase())\n      );\n    } else {\n      return false;\n    }\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Form, getEntityRevision } from '@igo2/common';\nimport type { FormComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FEATURE } from '../shared/feature.enums';\nimport { Feature, FeatureMeta } from '../shared/feature.interfaces';\n\n/**\n * A configurable form, optionnally bound to a feature.\n * This component creates an entity form and, on submit,\n * returns a feature made out of the submitted data. It also\n * does things like managing the feature visibility while it's being updated\n * as well as disabling the selection of another feature.\n */\n@Component({\n  selector: 'igo-feature-form',\n  templateUrl: './feature-form.component.html',\n  styleUrls: ['./feature-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FeatureFormComponent {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Feature to update\n   */\n  @Input()\n  set feature(value: Feature | undefined) { this.feature$.next(value); }\n  get feature(): Feature | undefined { return this.feature$.value; }\n  readonly feature$: BehaviorSubject<Feature> = new BehaviorSubject(undefined);\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<Feature>();\n\n  @ViewChild('igoForm', { static: true }) igoForm: FormComponent;\n\n  constructor() {}\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit(data: { [key: string]: any }) {\n    const feature = this.formDataToFeature(data);\n    this.submitForm.emit(feature);\n  }\n\n  getData(): Feature {\n    return this.formDataToFeature(this.igoForm.getData());\n  }\n\n  /**\n   * Transform the form data to a feature\n   * @param data Form data\n   * @returns A feature\n   */\n  private formDataToFeature(data: { [key: string]: any }): Feature {\n    const properties = {};\n    const meta = {};\n    if (this.feature === undefined) {\n      (meta as any).id = uuid();\n    } else {\n      Object.assign(properties, this.feature.properties);\n      Object.assign(meta, this.feature.meta, {\n        revision: getEntityRevision(this.feature) + 1\n      });\n    }\n\n    const propertyPrefix = 'properties.';\n    Object.entries(data).forEach((entry: [string, any]) => {\n      const [key, value] = entry;\n      if (key.startsWith(propertyPrefix)) {\n        const property = key.substr(propertyPrefix.length);\n        properties[property] = value;\n      }\n    });\n\n    let geometry = data.geometry;\n    if (geometry === undefined && this.feature !== undefined) {\n      geometry = this.feature.geometry;\n    }\n\n    return {\n      meta: meta as FeatureMeta,\n      type: FEATURE,\n      geometry,\n      projection: 'EPSG:4326',\n      properties\n    };\n  }\n}\n","\n<igo-form\n  #igoForm\n  [form]=\"form\"\n  [formData]=\"feature$ | async\"\n  (submitForm)=\"onSubmit($event)\">\n\n  <ng-content></ng-content>\n  \n  <ng-content select=\"[formButtons]\" formButtons></ng-content>\n  \n</igo-form>\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: typeof OlGeometryType | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n     public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometryType | undefined | string;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n\n  private mousePosition: [number, number];\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: typeof OlGeometryType) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      olDrawInteraction = new OlDraw({\n        type: this.olGeometryType,\n        source: this.getSource(),\n        stopClick: true,\n        style: this.options.interactionStyle,\n        maxPoints: this.options.maxPoints,\n        freehand: false,\n        freehandCondition: () => false\n      });\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType,\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n    this.onDrawAbortKey = olDrawInteraction.on('drawabort', (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry()));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey, this.onDrawAbortKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n    selector: 'igo-draw-popup-component',\n    templateUrl: './draw-popup.component.html',\n    styleUrls: ['./draw-popup.component.scss'],\n  })\n  export class DrawPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<DrawPopupComponent>,\n      @Inject(MAT_DIALOG_DATA) public data: {currentLabel: string}) {}\n\n    noLabel() {\n      this.dialogRef.close();\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{'igo.geo.draw.dialogInstruction' | translate}}</p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\"\n      value=\"{{data.currentLabel}}\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    (click)=\"noLabel()\">{{'igo.geo.draw.noLabel' | translate}}\n  </button>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    [mat-dialog-close]=\"input.value\">OK\n  </button>\n</div>","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm²',\n  [MeasureAreaUnit.SquareKilometers]: 'km²',\n  [MeasureAreaUnit.SquareMiles]: 'mi²',\n  [MeasureAreaUnit.SquareFeet]: 'ft²',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { transform } from 'ol/proj';\nimport { MapService } from '../../map/shared/map.service';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawStyleService {\n\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n\n  constructor(\n    private mapService: MapService\n  ) {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  createDrawingLayerStyle(feature, resolution, labelsAreShown?: boolean, icon?: string): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const proj = this.mapService.getMap().projection;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        image: new OlStyle.Circle({\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n\n    // if feature is an icon\n    } else if (icon) {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          offsetY: -26,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill:  new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n    // if feature is a point, a linestring or a polygon\n    } else {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: '20px sans-serif',\n          overflow: true,\n          offsetY: labelsAreOffset ? -15 : 0\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{('igo.geo.draw.' + geometryType.Point) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{('igo.geo.draw.' + geometryType.LineString) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{('igo.geo.draw.' + geometryType.Polygon) | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{('igo.geo.draw.' + geometryType.Circle) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{'igo.geo.draw.toggleMapTooltips' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <form class=\"igo-form\" [formGroup]=\"form\" >\n    <div class=\"fill-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n        {{'igo.geo.draw.fill' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"fill-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{fillColor}}</mat-label>\n\n        <input\n          formControlName=\"fill\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"fillColor\"\n          [style.background]=\"fillColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"fillColor\"\n          [cpWidth]=\"('200px')\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"stroke-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\"></mat-icon>\n        {{'igo.geo.draw.stroke' | translate}}\n      </span>\n\n      <mat-form-field\n        class=\"stroke-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{strokeColor}}</mat-label>\n\n        <input\n          formControlName=\"stroke\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"strokeColor\"\n          [style.background]=\"strokeColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"strokeColor\"\n          [cpWidth]=\"('200px')\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancelColorPicker' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div>\n      <mat-form-field *ngIf=\"icons.length >= 1\">\n        <mat-label>{{'igo.geo.draw.icon' | translate}}</mat-label>\n        <mat-select>\n          <mat-select-trigger>\n            <div *ngIf=\"icon\" class=\"box\">\n              <img src={{icon}}>\n            </div>\n          </mat-select-trigger>\n          <mat-option value=\"\" (click)=\"onIconChange()\">{{'igo.geo.draw.noIcon' | translate}}</mat-option>\n          <mat-option\n            *ngFor=\"let icon_html of icons\"\n            [value]=\"icon_html\"\n            (click)=\"onIconChange(icon_html)\">\n            <div class=\"box\">\n              <img src={{icon_html}}>\n            </div>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n\n  <mat-divider></mat-divider>\n\n  <div>\n    <button *ngIf=\"store.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <igo-entity-table\n      #table\n      class=\"table-compact\"\n      [store]=\"store\"\n      [template]=\"tableTemplate\">\n    </igo-entity-table>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\">\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output\n} from '@angular/core';\n\nimport {\n    FEATURE,\n    FeatureStore,\n    FeatureStoreSelectionStrategy,\n    tryBindStoreLayer,\n    tryAddLoadingStrategy,\n    tryAddSelectionStrategy,\n    FeatureMotion,\n    FeatureStoreLoadingStrategy\n  } from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { GeometryType } from '../shared/draw.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { FormGroup, FormBuilder } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance } from 'ol/sphere';\nimport { DrawStyleService } from '../shared/draw-style.service';\nimport { skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\n\n@Component ({\n  selector: 'igo-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [{\n      name: 'Drawing',\n      title: this.languageService.translate.instant('igo.geo.draw.labels'),\n      valueAccessor: (feature: FeatureWithDraw) => {\n        return feature.properties.draw;\n      }\n    }]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input() store: FeatureStore<FeatureWithDraw>; // Drawing store\n\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n\n  private olDrawingLayerSource = new OlVectorSource();\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  private olDrawingLayer: VectorLayer;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> = new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: FormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: FormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    this.initStore();\n    this.drawControl = this.createDrawControl(this.fillColor, this.strokeColor, this.strokeWidth);\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.drawControl.setOlMap(undefined);\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n  private initStore() {\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer',\n      title: this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, this.labelsAreShown, this.icon);\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n    tryBindStoreLayer(this.store, this.olDrawingLayer);\n\n    tryAddLoadingStrategy(this.store, new FeatureStoreLoadingStrategy({\n      motion: FeatureMotion.None\n    }));\n\n    tryAddSelectionStrategy(this.store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.None,\n      many: true\n    }));\n    this.store.layer.visible = true;\n    this.store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry();\n      this.clearLabelsOfOlGeometry(olGeometry);\n    });\n\n    this.subscriptions$$.push(this.store.stateView.manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    ).subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ? this.store.layer.options.showInLayerList = true : this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   */\n  onColorChange(labelsAreShown: boolean, isAnIcon: boolean) {\n    this.fillForm = this.fillColor;\n    this.strokeForm = this.strokeColor;\n    this.drawStyleService.setFillColor(this.fillColor);\n    this.drawStyleService.setStrokeColor(this.strokeColor);\n\n    if (isAnIcon) {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown, this.icon);\n      });\n      this.icon = undefined;\n\n    } else {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(feature, resolution, labelsAreShown);\n      });\n    }\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDialog(olGeometryFeature, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: {currentLabel: olGeometryFeature.get('draw')}\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((label: string) => {\n        this.updateLabelOfOlGeometry(olGeometryFeature, label);\n\n        // if event was fired at draw end\n        if (isDrawEnd) {\n          this.onDrawEnd(olGeometryFeature);\n\n        // if event was fired at select\n        } else {\n          this.onSelectDraw(olGeometryFeature, label);\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.openDialog(olGeometry, true);\n    });\n\n    this.drawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.drawControl.select$.subscribe((olFeature: OlFeature<OlGeometry>) => {\n        this.openDialog(olFeature, false);\n      });\n    }\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.store.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.store.all();\n\n    entities.forEach(entity => {\n      const entityId = entity.properties.id;\n\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string) {\n    const entities = this.store.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(olGeometry.getCoordinates()[0]);\n\n    entities.forEach(entity => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n\n      if (olGeometryCoordinates === entityCoordinates) {\n        const rad: number = entity.properties.rad ? entity.properties.rad : undefined;\n\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, radius?: number, feature?: FeatureWithDraw) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform([olGeometry.getFlatCoordinates()[2], olGeometry.getFlatCoordinates()[3]], projection, 'EPSG:4326');\n        center4326 = transform([olGeometry.getFlatCoordinates()[0], olGeometry.getFlatCoordinates()[1]], projection, 'EPSG:4326');\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n      }\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(olGeometry.getFlatCoordinates(), projection, 'EPSG:4326');\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null\n      },\n      meta: {\n       id: featureId\n      }\n    });\n  }\n\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(entity, olGeometry: OlGeometry, radius?: number) {\n    this.store.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  deleteDrawings() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawingLayerSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip && olTooltip.getMap()) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon ? this.onColorChange(this.labelsAreShown, true) : this.onColorChange(this.labelsAreShown, false);\n    }\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param olGeometry the geometry\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(olGeometry: OlGeometry, label: string) {\n    olGeometry.setProperties({\n      _label: label\n    }, true);\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.store.layer.ol.setStyle((feature, resolution) => {\n      return this.drawStyleService.createDrawingLayerStyle(feature, resolution, true, this.icon);\n    });\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule\n  ],\n  declarations: [\n    DrawComponent,\n    DrawPopupComponent,\n    DrawShorcutsComponent\n  ],\n  exports: [\n    DrawComponent\n  ]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { IgoDrawModule } from './draw/draw.module';\n\n@NgModule({\n    imports: [\n\n    ],\n    declarations: [\n    ],\n    exports: [\n        IgoDrawModule\n    ]\n})\n\nexport class IgoDrawingToolModule {}\n","import { OnInit, Directive, Self, HostListener, ElementRef, Output, EventEmitter } from '@angular/core';\nimport { FeatureDetailsComponent } from './feature-details.component';\n\nimport olGeolocation from 'ol/Geolocation';\nimport * as olProj from 'ol/proj';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport pointOnFeature from '@turf/point-on-feature';\nimport { Feature, FEATURE } from '../shared';\n\n@Directive({\n  // This directive allow to view the route between the user coordinates and the feature\n  selector: '[igoFeatureDetailsDirective]'\n})\n\nexport class FeatureDetailsDirective implements OnInit {\n  private component: FeatureDetailsComponent;\n  public geolocation$ = new BehaviorSubject<olGeolocation>(undefined);\n\n  public start: Feature = {\n    meta: { id: 1 },\n    type: FEATURE,\n    geometry: {\n      type: 'Point',\n      coordinates: undefined\n    },\n    projection: 'EPSG:4326',\n    properties: {\n      id: 1,\n      name: 'User coordinates',\n    }\n  };\n\n  public end: Feature;\n\n  get map() {\n    return this.component.map;\n  }\n\n  get feature() {\n    return this.component.feature;\n  }\n  feature$ = new BehaviorSubject(undefined);\n\n  get geolocation() {\n    return this.component.map.geolocation$.getValue();\n  }\n  set geolocation(value) {\n    if (value) {\n      this.geolocation = value;\n      this.geolocation.on('change', evt => {\n        this.geolocation$.next(this.geolocation);\n      });\n    }\n  }\n\n  @Output() routingEvent = new EventEmitter<Feature[]>();\n\n  @HostListener('selectFeature')\n  setFeature() {\n    this.feature$.next(this.feature);\n  }\n\n  constructor(\n    @Self() component: FeatureDetailsComponent,\n    private el: ElementRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.map.geolocation$.subscribe(geolocation => {\n      if (!geolocation) {\n        return;\n      }\n      geolocation.setProjection(this.map.projection);\n\n      if (geolocation && geolocation.getTracking() === false) {\n        geolocation.setTracking(false);\n      }\n\n      if (geolocation.getTracking() === true) {\n        let userCoord = geolocation.getPosition();\n        userCoord = olProj.transform(userCoord, this.map.projection, 'EPSG:4326');\n        this.start.geometry.coordinates = userCoord;\n      }\n    });\n\n    this.feature$.subscribe(() => {\n      if (this.feature.geometry) {\n        if (this.feature.geometry.type === 'Point') {\n          this.end = this.feature;\n        } else {\n          this.end = pointOnFeature(this.feature.geometry);\n        }\n        this.geolocation$.next(this.geolocation);\n        this.bindClicking();\n      }\n    });\n  }\n\n  bindClicking() {\n    setTimeout(() => {\n      const routeElement = this.el.nativeElement.querySelector('span.routing');\n      if (routeElement) {\n        routeElement.addEventListener('click', () => {\n          this.activateRouting();\n        });\n      }\n    }, 1);\n  }\n\n  activateRouting() {\n    this.start.geometry.coordinates ? this.routingEvent.emit([this.start, this.end]) : this.routingEvent.emit([this.end]);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = event.feature\n      .getGeometry()\n      .getLinearRing()\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlLineString from 'ol/geom/LineString';\n\nimport { Subject, Subscription } from 'rxjs';\n\nimport { GeometrySliceError } from '../geometry.errors';\nimport { sliceOlGeometry } from '../geometry.utils';\nimport { DrawControl } from './draw';\n\nexport interface SliceControlOptions {\n  source?: OlVectorSource<OlGeometry>;\n  layer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n}\n\n/**\n * Control to modify geometries\n */\nexport class SliceControl {\n\n  /**\n   * Slice end observable\n   */\n  public end$: Subject<OlGeometry[]> = new Subject();\n\n  /**\n   * Slice error, if any\n   */\n  public error$: Subject<GeometrySliceError> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawLineStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawLineEnd$$: Subscription;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  constructor(private options: SliceControlOptions) {\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeDrawLineControl();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addDrawLineControl();\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay for slicing\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({geometry: olGeometry});\n    this.olOverlaySource.clear(true);\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  /**\n   * Create a draw line control and add it to the map\n   */\n  private addDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      interactionStyle: this.options.drawStyle,\n      maxPoints: 2\n    });\n    this.drawLineStart$$ = this.drawLineControl.start$\n      .subscribe((olLine: OlLineString) => this.onDrawLineStart(olLine));\n    this.drawLineEnd$$ = this.drawLineControl.end$\n      .subscribe((olLine: OlLineString) => this.onDrawLineEnd(olLine));\n    this.drawLineControl.setOlMap(this.olMap);\n  }\n\n  /**\n   * Remove draw line control\n   */\n  private removeDrawLineControl() {\n    if (this.drawLineControl === undefined) {\n      return;\n    }\n\n    this.drawLineStart$$.unsubscribe();\n    this.drawLineEnd$$.unsubscribe();\n    this.drawLineControl.getSource().clear(true);\n    this.drawLineControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olLine Ol linestring or polygon\n   */\n  private onDrawLineStart(olLine: OlLineString) {\n    this.drawLineControl.getSource().clear(true);\n  }\n\n  /**\n   * Slice the first geometry encountered with the drawn line\n   * @param olLine Ol linestring\n   */\n  private onDrawLineEnd(olLine: OlLineString) {\n    const olSlicedGeometries = [];\n    const lineExtent = olLine.getExtent();\n\n    const olFeaturesToRemove = [];\n    try {\n      this.olOverlaySource.forEachFeatureInExtent(lineExtent, (olFeature: OlFeature<OlGeometry>) => {\n        const olGeometry = olFeature.getGeometry() as any;\n        const olParts = sliceOlGeometry(olGeometry, olLine);\n        if (olParts.length > 0) {\n          olSlicedGeometries.push(...olParts);\n          olFeaturesToRemove.push(olFeature);\n        }\n      });\n    } catch (e) {\n      if (e instanceof GeometrySliceError) {\n        this.error$.next(e);\n        return;\n      } else {\n        throw e;\n      }\n    }\n\n    this.drawLineControl.getSource().clear(true);\n\n    this.olOverlaySource.addFeatures(\n      olSlicedGeometries.map((olGeometry: OlGeometry) => new OlFeature(olGeometry))\n    );\n    olFeaturesToRemove.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.olOverlaySource.removeFeature(olFeature);\n    });\n\n    this.error$.next(undefined);\n    this.end$.next(olSlicedGeometries);\n  }\n}\n","export const LAYER = 'Layer';\n","export enum LayerListToolControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n    this.drawChanges$$ = drawControl.abort$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      });\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: typeof OlGeometryType) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): typeof OlGeometryType { return this._geometryType; }\n  private _geometryType: typeof OlGeometryType;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyle.Style |\n    ((feature, resolution) => OlStyle.Style) |\n    OlStyle.Circle,\n    resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\n    if (olGuideStyle === undefined) {\n      return;\n    }\n\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private isStyleWithRadius(olStyle) {\n    return typeof olStyle !== 'function' && olStyle.setRadius;\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\n  ) {\n    if (Array.isArray(olStyle)) {\n      olStyle = olStyle[0];\n    }\n    if (this.isStyleWithRadius(olStyle)) {\n      return olStyle;\n    }\n    return undefined;\n  }\n}\n","<ng-template></ng-template>","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType$ | async\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [controlOptions]=\"controlOptions\"\n  [drawStyle]=\"drawStyle\"\n  [overlayStyle]=\"overlayStyle\">\n</igo-geometry-form-field-input>\n\n<div *ngIf=\"geometryTypeField\" class=\"geometry-type-toggle\">\n  <mat-button-toggle-group\n    [disabled]=\"(value$ | async) !== undefined\"\n    [(ngModel)]=\"geometryType\">\n    <mat-button-toggle\n      value=\"Point\"\n      [disabled]=\"geometryTypes.indexOf('Point') < 0\">\n      {{'igo.geo.geometry.point' | translate}}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"LineString\"\n      [disabled]=\"geometryTypes.indexOf('LineString') < 0\">\n      {{'igo.geo.geometry.line' | translate}}\n    </mat-button-toggle>\n    <mat-button-toggle\n      value=\"Polygon\"\n      [disabled]=\"geometryTypes.indexOf('Polygon') < 0\">\n      {{'igo.geo.geometry.polygon' | translate}}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<mat-form-field *ngIf=\"drawGuideField\" class=\"draw-guide-field\">\n  <input\n    matInput\n    type=\"number\"\n    [placeholder]=\"drawGuidePlaceholder\"\n    [(ngModel)]=\"drawGuide\">\n  <mat-icon\n    matPrefix\n    [color]=\"'primary'\"\n    svgIcon=\"adjust\">    \n  </mat-icon>\n  <span matSuffix class=\"draw-guide-units\">{{'igo.geo.measure.meters' | translate}}</span>\n</mat-form-field>","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef, Component,\n  Input, OnDestroy, OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { IgoFormFieldComponent } from '@igo2/common';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport * as OlStyle from 'ol/style';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { IgoMap } from '../../map';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map.\n */\n@IgoFormFieldComponent('geometry')\n@Component({\n  selector: 'igo-geometry-form-field',\n  templateUrl: './geometry-form-field.component.html',\n  styleUrls: ['./geometry-form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldComponent implements OnInit, OnDestroy {\n\n  readonly value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get drawControlIsActive(): boolean {\n    return this._drawControlIsActive;\n  }\n  private _drawControlIsActive = true;\n\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.cdRef.detectChanges();\n  }\n\n  get freehandDrawIsActive(): boolean {\n    return this._freehandDrawIsActive;\n  }\n  private _freehandDrawIsActive = false;\n\n  /**\n   * The field's form control\n   */\n  @Input() formControl: FormControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  set geometryType(value: typeof OlGeometryType) { this.geometryType$.next(value); }\n  get geometryType(): typeof OlGeometryType { return this.geometryType$.value; }\n  readonly geometryType$: BehaviorSubject<typeof OlGeometryType> = new BehaviorSubject(undefined);\n\n  /**\n   * Whether a geometry type toggle should be displayed\n   */\n  @Input() geometryTypeField: boolean = false;\n\n  /**\n   * Available geometry types\n   */\n  @Input() geometryTypes: string[] = ['Point', 'LineString', 'Polygon'];\n\n  /**\n   * Whether a draw guide field should be displayed\n   */\n  @Input() drawGuideField: boolean = false;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input()\n  set drawGuide(value: number) { this.drawGuide$.next(value); }\n  get drawGuide(): number { return this.drawGuide$.value; }\n  readonly drawGuide$: BehaviorSubject<number> = new BehaviorSubject(0);\n\n  /**\n   * Draw guide placeholder\n   */\n  @Input() drawGuidePlaceholder: string = '';\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input() drawStyle: OlStyle.Style;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input() overlayStyle: OlStyle.Style;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Set up a value stream\n   * @internal\n   */\n  ngOnInit() {\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      this.value$.next(value ? value : undefined);\n    });\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport * as moment from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { TimeFilterListComponent } from './time-filter-list.component';\n\n@Directive({\n  selector: '[igoTimeFilterListBinding]'\n})\nexport class TimeFilterListBindingDirective implements OnInit, OnDestroy {\n  private component: TimeFilterListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: TimeFilterListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\n      this.component.layers = layers;\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<mat-list-item>\n\n  <mat-icon\n    *ngIf=\"header\"\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse [target]=\"ogcFilters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\">\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n    <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n    <button *ngIf=\"header\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"layer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"layer.visible = !layer.visible\">\n      <mat-icon\n        [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n</mat-list-item>\n\n<div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n  <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n  </igo-ogc-filterable-form>\n\n  <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n    <mat-divider></mat-divider>\n    <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n      [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n      {{'igo.geo.filter.advancedOgcFilters' | translate}}\n    </mat-checkbox>\n  </section>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MapService } from '../../map/shared/map.service';\nimport { OgcFilterableListComponent } from './ogc-filterable-list.component';\n\n@Directive({\n  selector: '[igoOgcFilterableListBinding]'\n})\nexport class OgcFilterableListBindingDirective implements OnInit, OnDestroy {\n  private component: OgcFilterableListComponent;\n  private layers$$: Subscription;\n\n  constructor(\n    @Self() component: OgcFilterableListComponent,\n    private mapService: MapService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    this.component.layers = [];\n\n    this.layers$$ = this.mapService.getMap().layers$.subscribe(layers => {\n      this.component.layers = layers.filter(layer => layer.showInLayerList);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors.map(cb => cntPushButtons += (cb.selectors as any).filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors.map(cb => cntCheckboxes += (cb.selectors as any).filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors.map(cb => cntRadioButtons += (cb.selectors as any).filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors.map(cb => cntSelect += (cb.selectors as any).filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (filter.filters && filter.filters.operator === 'During' && filter.filters.active &&\n      filter.interfaceOgcFilters && filter.interfaceOgcFilters[0].active) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if ((filterActiveValue.begin.substring(0,4) !== this.options.minDate.substring(0,4) ) ||\n        (filterActiveValue.end.substring(0,4) !== this.options.maxDate.substring(0,4) )) {\n          cnt += 1;\n        }\n      } else if ((filterActiveValue.begin !== this.options.minDate) || (filterActiveValue.end !== this.options.maxDate)) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field>\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enableds\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"allSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"optionClick()\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\"\n                [formControl]=\"select\" [(ngModel)]=\"enabled\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4 *ngIf=\"!currentFilter.title\">{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <h4 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\nimport { debounceTime } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss']\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: FormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public allSelected = false;\n  public select = new FormControl();\n  public enabled$ = new BehaviorSubject(undefined);\n  public enableds$ = new BehaviorSubject([]);\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n  }\n\n  get enabled() {\n    return this.enabled$.value;\n  }\n\n  set enabled(value) {\n    this.enabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get enableds() {\n    return this.enableds$.value;\n  }\n\n  set enableds(value) {\n    this.enableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: FormBuilder,\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.enableds = enableds;\n      } else {\n        compSelect.selectors.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.enabled = enabled;\n      }\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.enabled = [];\n  }\n\n  toggleAllSelection() {\n    if (this.allSelected) {\n      this.sel.options.forEach((item: MatOption) => item.select());\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n    }\n  }\n\n  optionClick() {\n    let newStatus = true;\n    this.sel.options.forEach((item: MatOption) => {\n      if (!item.selected) {\n        newStatus = false;\n      }\n    });\n    this.allSelected = newStatus;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors\n          .filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' | translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' | translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' | translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' | translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { FormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new FormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' | translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new FormControl();\n\n  public bufferFormControl = new FormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"(selectedItemType==='Thematics' && !tableTemplate) || (selectedItemType==='Thematics' && tableTemplate && !listIsVisible)\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div class=\"results\" *ngIf=\"store.all().length && tableTemplate && listIsVisible\">\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\">\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { FormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore, EntityStoreFilterSelectionStrategy, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new FormControl();\n  public geometryType: typeof OlGeometryType | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new FormControl();\n  public bufferFormControl = new FormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(\n      debounceTime(500)\n    ).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.type'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.searchResults'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearBegin}}\"\n          (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]= \"filterStateDisable\"\n          >\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n  \n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          >\n        </mat-datepicker>\n\n        <input #beginYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearEnd}}\"\n          (change)= \"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled] = \"filterStateDisable\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n          >\n        </mat-datepicker>\n\n        <input #endYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n          [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n      <button class=\"reset-button\" \n        mat-icon-button\n        color=\"primary\" \n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class='toggle-filter-state' \n        (change)=\"toggleFilterState()\" \n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [checked]=\"!filterStateDisable\">\n      </mat-slide-toggle>\n\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType()!=='year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n          <input #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"dateFilter.bind(this, 'begin')\"\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" \n            [disabled]= \"filterStateDisable\">\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n            <input #end\n              matInput\n              [matDatepicker]=\"endDatepicker\"\n              [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n              [matDatepickerFilter]=\"dateFilter.bind(this, 'end')\"\n              [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n              [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n              [max]=\"handleDate(datasource.options.maxDate)\" \n              [disabled]= \"filterStateDisable\">\n            <span class=\"filler\"></span>\n            <mat-datepicker #endDatepicker\n              [startView]=\"calendarView()\"\n              [startAt]=\"endValue\"\n              (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n              (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <button class=\"reset-button\" \n        mat-icon-button color=\"primary\"\n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class=\"toggle-filter-state\" \n        (change)=\"toggleFilterState()\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        [checked]= \"!filterStateDisable\">\n      </mat-slide-toggle>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new FormControl();\n  beginMinuteFormControl = new FormControl();\n  endHourFormControl = new FormControl();\n  endMinuteFormControl = new FormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ) {\n      if (filter.search('now') >= 0 ) {\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({ value: dateStringFromYearNotime, pos: position, refreshFilter });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof(value) === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep() && !this.calendarTypeYear) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string): boolean {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asYears()) === 0;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asMonths()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        return (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n      } else if ( type === 'begin' ) {\n        return (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        return (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        return (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n      return (hourDiff % moment.duration(this.step).asHours()) === 0;\n\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      return true;\n    }\n\n    return diff % this.stepMilliseconds === 0;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if(this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de l’Est nord-américain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n       const dateItems = stringDate.split('-');\n        if (dateItems.length !== 3) {\n          throw new Error('Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY');\n        } else {\n          year = dateItems[0];\n          month = dateItems[1];\n          day = dateItems[2];\n        }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters.filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0,4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0,4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0,4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if ((this.currentFilter.begin !== minDefaultISOString ) ||\n    (this.currentFilter.end !== maxDefaultISOString)) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport * as moment_ from 'moment';\nimport { MatSlider } from '@angular/material/slider';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","<button\n  *ngIf=\"layerIsExportable()\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\">\n  <!-- (click)=\"openDownload(layer)\"> -->\n  <mat-icon svgIcon=\"file-export\"></mat-icon>\n</button>\n\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { VectorLayer } from '../../layer';\nimport { DataSourceOptions } from '../../datasource';\n\n@Component({\n  selector: 'igo-export-button',\n  templateUrl: './export-button.component.html',\n  styleUrls: ['./export-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ExportButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor() {}\n\n  get options(): DataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n\n  layerIsExportable(): boolean {\n    if (\n      (this.layer instanceof VectorLayer && this.layer.exportable === true) ||\n      (this.layer.dataSource.options.download && this.layer.dataSource.options.download.url) ||\n      (this.layer.options.workspace?.enabled &&\n        this.layer.options.workspace?.workspaceId !== this.layer.id)\n    ) {\n      return true;\n    }\n    return false;\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService, languageService);\n    return;\n  }\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.failed.title');\n  const message = translate.instant('igo.geo.export.failed.text');\n  messageService.error(message, title);\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.success.title');\n  const message = translate.instant('igo.geo.export.success.text');\n  messageService.success(message, title);\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.nothing.title');\n  const message = translate.instant('igo.geo.export.nothing.text');\n  messageService.error(message, title);\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  private generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","import * as olStyle from 'ol/style';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = feature => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style')\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    const baseStyle = styleService.createStyle(\n      styleListService.getStyleList('default.clusterStyle')\n    );\n\n    style = feature => {\n      return styleService.createClusterStyle(feature, clusterParam, baseStyle);\n    };\n  } else {\n    style = styleService.createStyle(\n      styleListService.getStyleList('default.style')\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    source,\n    style\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  messageService: MessageService,\n  languageService: LanguageService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const layerTitle = computeLayerTitleFromFile(file);\n\n  if (!styleListService) {\n    addLayerAndFeaturesToMap(features, map, layerTitle);\n  } else {\n    addLayerAndFeaturesStyledToMap(\n      features,\n      map,\n      layerTitle,\n      styleListService,\n      styleService\n    );\n  }\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\n    value: layerTitle\n  });\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\n    value: file.name\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\n    value: file.name,\n    size: sizeMb\n  });\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\n  messageService.error(message, title);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...ImportService.allowedZipMimeTypes\n    ];\n    const allowedExtensions = ImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n    .subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n  <ul>\n    <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n    <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n    <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n  </ul>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-combine-layers mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\">\n    <mat-slide-toggle\n        formControlName=\"combineLayers\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportCombineResults' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-separator mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon') && form.value.combineLayers\">\n    <mat-slide-toggle\n        formControlName=\"separator\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportSeparator' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: FormGroup;\n  public importForm: FormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: FormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string, features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = \"\";\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma)\n      || !data.combineLayers || data.layers.length === 1) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant('igo.geo.export.combinedLayers');\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      const translate = this.languageService.translate;\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\n          this.messageService.error(message, title, { timeOut: 20000 });\n        }\n      } else if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n        geomTypes.forEach(geomType => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach(geomType => {\n            geomType.features.forEach(currentFeature => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (currentFeature.get('_featureStore').layer.options.title !==\n                  previousFeature.get('_featureStore').layer.options.title) {\n                    const titleEmptyRows = this.createTitleEmptyRows(previousFeature, currentFeature);\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(currentFeature, currentFeature);\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        const title = translate.instant('igo.geo.export.nothing.title');\n        const message = translate.instant('igo.geo.export.nothing.text');\n        this.messageService.error(message, title, { timeOut: 20000 });\n\n      } else {\n        if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) || !data.combineLayers) {\n          geomTypes.map(geomType =>\n            this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n            .subscribe(\n              () => {},\n              (error: Error) => this.onFileExportError(error),\n              () => {\n                this.onFileExportSuccess();\n\n                geomType.features.forEach(feature => {\n                  this.circleToPoint(feature);\n                });\n\n                this.loading$.next(false);\n            }\n          ));\n        }\n      }\n    };\n    if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n      this.exportService.export(featuresCSV, data.format, filename, data.encoding, this.map.projection)\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n\n          featuresCSV.forEach(feature => {\n            this.circleToPoint(feature);\n          });\n\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach(previousKey => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach(key => {\n      const sameKeys: boolean = previousFeatureKeys.length === currentFeatureKeys.length &&\n      previousFeatureKeys.every((value, index) => value === currentFeatureKeys[index]);\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title + \" ===============>\", true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!(currentFeatureKeys.includes(key))) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\n    const extraMessage = preCheck ?\n      translate.instant('igo.geo.export.popupBlocked.selectAgain') :\n      translate.instant('igo.geo.export.popupBlocked.retry');\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\n    this.messageService.error(message, title, { timeOut: 20000 });\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService, this.languageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    if (this.config.getConfig('importExport.formats') !== undefined) {\n      const validatedListFormat = this.validateListFormat(\n        this.config.getConfig('importExport.formats')\n      );\n      appliedformats = validatedListFormat;\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\n              this.languageService.translate.instant('igo.geo.export.customList.title')\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService, this.languageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { Directive, HostListener, EventEmitter, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { MessageService, LanguageService, ConfigService } from '@igo2/core';\nimport { DragAndDropDirective } from '@igo2/common';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { ImportService } from './import.service';\nimport { handleFileImportSuccess, handleFileImportError } from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { concatMap, first, skipWhile } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoDropGeoFile]'\n})\nexport class DropGeoFileDirective extends DragAndDropDirective implements OnInit, OnDestroy {\n\n  protected filesDropped: EventEmitter<File[]> = new EventEmitter();\n  protected filesInvalid: EventEmitter<File[]> = new EventEmitter();\n  private epsgCode$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  private epsgCode$$: Subscription[] = [];\n  private filesDropped$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private importService: ImportService,\n    private languageService: LanguageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private config: ConfigService,\n    private messageService: MessageService\n  ) {\n    super();\n  }\n\n  ngOnInit() {\n    this.filesDropped$$ = this.filesDropped.subscribe((files: File[]) => {\n      this.onFilesDropped(files);\n    });\n  }\n\n  ngOnDestroy() {\n    this.filesDropped$$.unsubscribe();\n  }\n\n  @HostListener('dragover', ['$event'])\n  public onDragOver(evt) {\n    super.onDragOver(evt);\n  }\n\n  @HostListener('dragleave', ['$event'])\n  public onDragLeave(evt) {\n    super.onDragLeave(evt);\n  }\n\n  @HostListener('drop', ['$event'])\n  public onDrop(evt) {\n    super.onDrop(evt);\n  }\n\n  private onFilesDropped(files: File[]) {\n    for (const file of files) {\n      this.detectEPSG(file);\n      this.epsgCode$$.push(\n        this.epsgCode$.pipe(\n          skipWhile((code) => !code),\n          first(),\n          concatMap(epsgCode => {\n            const epsg = epsgCode === 'epsgNotDefined' ? undefined : epsgCode;\n            this.epsgCode$.next(undefined);\n            return this.importService.import(file, epsg);\n          }),\n        ).subscribe(\n          (features: Feature[]) => this.onFileImportSuccess(file, features),\n          (error: Error) => this.onFileImportError(file, error)\n        ));\n    }\n  }\n\n  private detectEPSG(file: File, nbLines: number = 500) {\n    if (!file.name.toLowerCase().endsWith('.geojson') && !file.name.toLowerCase().endsWith('.gml')) {\n      this.epsgCode$.next('epsgNotDefined');\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      if (file.name.toLowerCase().endsWith('.geojson')) {\n        const geojson = JSON.parse(reader.result as string);\n        if (geojson.crs?.properties?.name) {\n          const epsg = geojson.crs.properties.name.match(/EPSG:{1,2}\\d{0,6}/gm);\n          if (epsg !== null && epsg.length) {\n            this.epsgCode$.next(epsg[0].replace(/::/g, ':'));\n            return;\n          } else {\n            this.epsgCode$.next('epsgNotDefined');\n            return;\n          }\n        } else {\n          this.epsgCode$.next('epsgNotDefined');\n          return;\n      }\n      } else if (file.name.toLowerCase().endsWith('.gml')) {\n        const text = (reader.result as string);\n        const lines = (text as string).split('\\n');\n        for (let line = 0; line <= nbLines; line++) {\n          const epsg = lines[line].match(/EPSG:\\d{0,6}/gm);\n          if (epsg !== null && epsg.length) {\n              this.epsgCode$.next(epsg[0]);\n              break;\n          } else {\n            this.epsgCode$.next(undefined);\n            return;\n          }\n        }\n      } else {\n        this.epsgCode$.next('epsgNotDefined');\n        return;\n      }\n    };\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService);\n    } else {\n      handleFileImportSuccess(file, features, this.map, this.messageService, this.languageService,\n                               this.styleListService, this.styleService);\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.config.getConfig('importExport.clientSideFileSizeMaxMb'));\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\nimport { IgoStyleListModule } from './style-list/style-list.module';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jspdf from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport * as JSZip from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions } from './print.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n\n    this.activityId = this.activityService.register();\n    const doc = new jspdf({\n      orientation,\n      format: paperFormat.toLowerCase()\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizeResults = [0, 0];\n\n    if (options.title !== undefined) {\n      titleSizeResults = this.getTitleSize(options.title, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addTitle(doc, options.title, titleSizeResults[0], margins[3] + titleSizeResults[1], titleSizeResults[0] * (25.4 / 72));\n    }\n    if (options.subtitle !== undefined) {\n      let subtitleSizeResult = 0;\n      const titleH = titleSizeResults[0];\n      subtitleSizeResult = this.getSubTitleSize(options.subtitle, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addSubTitle(doc, options.subtitle, titleH * 0.7, margins[3] + subtitleSizeResult, titleH * 1.7 * (25.4 / 72));\n      margins[0] = margins[0] + titleSizeResults[0] * 0.7 * (25.4 / 72);\n    }\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n      if (legends.length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n        div.parentNode.removeChild(div); // remove temp div (IE)\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  getTitleSize(title: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const pdfResolution = 96;\n    const titleSize = Math.round(2 * (pageHeight + 145) * 0.05) / 2;\n    doc.setFont('Times', 'bold');\n    const width = doc.getTextWidth(title);\n\n    const titleWidth = doc.getStringUnitWidth(title) * titleSize / doc.internal.scaleFactor;\n    const titleTailleMinimale = Math.round( 2 * (pageHeight + 150 ) * 0.037) / 2;\n    let titleFontSize = 0;\n\n    let titleMarginLeft;\n    if (titleWidth >= (pageWidth)) {\n      titleMarginLeft = 0;\n      titleFontSize = Math.round(((pageWidth / title.length) * pdfResolution) / 25.4);\n      // If the formula to find the font size gives below the defined minimum size\n      if (titleFontSize < titleTailleMinimale) {\n        titleFontSize = titleTailleMinimale;\n      }\n    } else {\n      titleMarginLeft = (pageWidth - titleWidth) / 2 ;\n      titleFontSize = titleSize;\n    }\n    return [titleFontSize, titleMarginLeft];\n  }\n\n  getSubTitleSize(subtitle: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const subtitleSize = 0.7 * Math.round(2 * (pageHeight + 145) * 0.05) / 2; // 70% of the title's font size\n\n    doc.setFont('Times', 'bold');\n\n    const subtitleWidth = doc.getStringUnitWidth(subtitle) * subtitleSize / doc.internal.scaleFactor;\n\n    let subtitleMarginLeft;\n    if (subtitleWidth >= (pageWidth)) {\n      subtitleMarginLeft = 0;\n    } else {\n      subtitleMarginLeft = (pageWidth - subtitleWidth) / 2 ;\n    }\n    return subtitleMarginLeft;\n  }\n\n  private addTitle(doc: jspdf, title: string, titleFontSize: number, titleMarginLeft: number, titleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(titleFontSize);\n    doc.text(title, titleMarginLeft, titleMarginTop);\n  }\n\n  private addSubTitle(doc: jspdf, subtitle: string, subtitleFontSize: number, subtitleMarginLeft: number, subtitleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(subtitleFontSize);\n    doc.text(subtitle, subtitleMarginLeft, subtitleMarginTop);\n  }\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   * * @param  size - Size of the document\n   */\n  private addComment(doc: jspdf, comment: string) {\n    const commentSize = 16;\n    const commentMarginLeft = 20;\n    const marginBottom = 5;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    doc.setFont('courier');\n    doc.setFontSize(commentSize);\n    doc.text(comment, commentMarginLeft, heightPixels);\n  }\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jspdf,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 16;\n    const projScaleMarginLeft = 20;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jspdf,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        div.parentNode.removeChild(div); // remove temp div (IE style)\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jspdf,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jspdf,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    legend = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Position in width to set the Proj/Scale in new canvas\n      let positionWProjScale = 10;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // Patch Jpeg default black background to white\n      if (format === 'jpeg') {\n        newContext.fillStyle = '#ffffff';\n        newContext.fillRect(0, 0, width, height);\n        newContext.fillStyle = '#000000';\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection need to be added to canvas\n      if (projection !== false) {\n        const projText = translate.instant('igo.geo.printForm.projection');\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          projText + ': ' + map.projection,\n          positionWProjScale,\n          positionHProjScale\n        );\n        positionWProjScale += 200; // Width position change for scale position\n      }\n\n      // If scale need to be added to canvas\n      if (scale !== false) {\n        const scaleText = translate.instant('igo.geo.printForm.scale');\n        const mapScale = map.viewController.getScale(resolution);\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\n          positionWProjScale,\n          positionHProjScale\n        );\n      }\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, 'map', format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(\n            newCanvas,\n            'map' + map.projection.replace(':', '_') + '.' + format\n          );\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, 'map' + '.' + format);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, 'map' + map.projection + '.tfw');\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(\n            'map' + map.projection.replace(':', '_') + '.tfw',\n            blob\n          );\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jspdf) {\n    await doc.save('map.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = canvas.height;\n    const canWidth = canvas.width;\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, name, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      // If navigator is Internet Explorer\n      if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(canvas.msToBlob(), name + '.' + format);\n        this.saveFileProcessing();\n      } else {\n        canvas.toBlob((blob) => {\n          // download image\n          saveAs(blob, name + '.' + format);\n          that.saveFileProcessing();\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  FormGroup,\n  FormBuilder,\n  FormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: FormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as FormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as FormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as FormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as FormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as FormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as FormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as FormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as FormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as FormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as FormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as FormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as FormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as FormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  constructor(private formBuilder: FormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', []],\n      subtitle: ['', []],\n      comment: ['', []],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n    } else {\n      this.isPrintService = true;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      let nbRequests = data.showLegend ? 2 : 1;\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.showLegend,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          nbRequests--;\n          if (!nbRequests) {\n            this.disabled$.next(false);\n          }\n        });\n      if (data.showLegend) {\n        this.printService\n          .getLayersLegendImage(\n            this.map,\n            data.imageFormat,\n            data.doZipFile,\n            +resolution\n          )\n          .then(() => {\n            nbRequests--;\n            if (!nbRequests) {\n              this.disabled$.next(false);\n            }\n          });\n      }\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(coordinates: [number, number][], directionsOptions: DirectionOptions): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          bidirectionnal: false,\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toLowerCase();\n  const termTo = caseSensitive ? to : to.toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    return this.reverseSearchSources(sources, lonLat, options || {});\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant(\n        'igo.geo.directionsForm.dialog.copyMsgLink'\n      );\n      this.messageService.success(msg, title);\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\n      this.messageService.success(msg, title);\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [contextUri]=\"contextUri\" [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalité', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['région-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repère', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\wÀ-ÿ !\\-\\+\\(\\)\\.\\/½¼¾,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data)+ ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[],\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\n    const roundedCoordStringDMS = dataDMS.join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = this.languageService.translate.instant('igo.geo.search.coordinates.coord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\wÀ-ÿ !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length > 0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length === 0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length > 3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n      </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': searchIcon}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      mat-icon-button\n      [color]=\"color\"\n      *ngIf=\"searchIcon !== undefined\">\n      <mat-icon svgIcon=\"{{searchIcon}}\"></mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search icon\n   */\n  @Input() searchIcon: string;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  Optional,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { RouteService } from '@igo2/core';\n\nimport { SearchBarComponent } from './search-bar.component';\n\n@Directive({\n  selector: '[igoSearchUrlParam]'\n})\nexport class SearchUrlParamDirective implements OnInit {\n  constructor(\n    @Self() private component: SearchBarComponent,\n    private ref: ChangeDetectorRef,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    if (this.route && this.route.options.searchKey) {\n      this.route.queryParams.subscribe(params => {\n        const searchParams = params[this.route.options.searchKey as string];\n        if (searchParams) {\n          this.component.setTerm(searchParams);\n          this.ref.detectChanges();\n        }\n      });\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item>\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  constructor() {}\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    // getStrategyOfType is to avoid display more result based on a filtered state\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    return !active && group.results &&\n      group.results[group.results.length - 1].meta.nextPage === true;\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<button\nigoStopPropagation\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(tooltip$ | async) | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  private resolution$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private layerService: LayerService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.tooltip$.next(this.computeTooltip());\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap();\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => this.map.addLayer(layer))\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n    /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n     private sortByOrder(r1: SearchResult, r2: SearchResult) {\n      return r1.source.displayOrder - r2.source.displayOrder;\n    }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\n      imgSize: [18, 18], // for ie\n    }),\n\n    text: new olstyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","<igo-flexible #flex\n  collapsedMobile=\"51px\"\n  expandedMobile=\"300px\"\n  [state]=\"state\"\n  (swipeup)=\"swipe($event.type)\"\n  (swipedown)=\"swipe($event.type)\">\n\n  <igo-panel [title]=\"title\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toggle()\">\n      <mat-icon [svgIcon]=\"['collapsed', 'initial'].indexOf(flex.state) >= 0 ? 'arrow_upward' : 'arrow_downward'\"></mat-icon>\n    </button>\n\n    <button mat-icon-button panelRightButton class=\"igo-icon-button\" (click)=\"zoomToFeatureExtent()\" *ngIf=\"feature.geometry\">\n      <mat-icon svgIcon=\"zoom-in\"></mat-icon>\n    </button>\n\n    <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n  </igo-panel>\n\n</igo-flexible>\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\nimport { FlexibleState, getEntityTitle } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { FeatureMotion } from '../feature/shared/feature.enums';\nimport { moveToOlFeatures } from '../feature/shared/feature.utils';\nimport { IgoMap } from '../map/shared/map';\n\n@Component({\n  selector: 'igo-toast',\n  templateUrl: './toast.component.html',\n  styleUrls: ['./toast.component.scss']\n})\nexport class ToastComponent {\n  static SWIPE_ACTION = {\n    UP: 'swipeup',\n    DOWN: 'swipedown'\n  };\n  private format = new olFormatGeoJSON();\n\n  @Input()\n  get expanded(): boolean {\n    return this._expanded;\n  }\n  set expanded(value: boolean) {\n    this.state = value ? 'expanded' : 'collapsed';\n    this._expanded = value;\n  }\n  private _expanded: boolean;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n  }\n  private _feature: Feature;\n\n  @Output() opened = new EventEmitter<boolean>();\n\n  public state: FlexibleState;\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.feature); }\n\n  constructor() {}\n\n  toggle() {\n    this.expanded = !this.expanded;\n    this.opened.emit(this.expanded);\n  }\n\n  zoomToFeatureExtent() {\n    if (this.feature.geometry) {\n      const olFeature = this.format.readFeature(this.feature, {\n        dataProjection: this.feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  swipe(action: string) {\n    if (action === ToastComponent.SWIPE_ACTION.UP) {\n      if (!this.expanded) {\n        this.toggle();\n      }\n    } else if (action === ToastComponent.SWIPE_ACTION.DOWN) {\n      if (this.expanded) {\n        this.toggle();\n      }\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFlexibleModule } from '@igo2/common';\n\nimport { IgoFeatureModule } from '../feature/feature.module';\nimport { ToastComponent } from './toast.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoPanelModule,\n    IgoFlexibleModule,\n    IgoFeatureModule\n  ],\n  exports: [ToastComponent],\n  declarations: [ToastComponent]\n})\nexport class IgoToastModule {\n  static forRoot(): ModuleWithProviders<IgoToastModule> {\n    return {\n      ngModule: IgoToastModule\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy } from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private layerService: LayerService, private storageService: StorageService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(lay => lay.id === layer.id + '.WfsWorkspaceTableDest') ||\n      layer.dataSource.options.edition) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n\n    let wks;\n    let wksLayerOption = {\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          queryFormatAsWms: (dataSource.options as QueryableDataSourceOptions).queryFormatAsWms,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id,\n            queryOptions: {\n              mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n              tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n            },\n            pageSize: layer.options.workspace?.pageSize,\n            pageSizeOptions: layer.options.workspace?.pageSizeOptions\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n    selector: 'igo-confirmation-popup-component',\n    templateUrl: './confirmation-popup.component.html',\n    styleUrls: ['./confirmation-popup.component.scss']\n  })\n  export class ConfirmationPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n      public languageService: LanguageService,\n      @Inject(MAT_DIALOG_DATA) public data: {type: string, cancel: boolean}) {}\n\n    cancelAction() {\n      this.data.cancel = true;\n      this.dialogRef.close(this.data.cancel);\n    }\n\n    confirmedAction() {\n      this.data.cancel = false;\n      this.dialogRef.close(this.data.cancel);\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{data.type === 'add' ?\n    languageService.translate.instant('igo.geo.workspace.addConfirmation') :\n    languageService.translate.instant('igo.geo.workspace.deleteConfirmation')}}</p>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"confirmedAction()\">Ok\n  </button>\n  <button\n    mat-raised-button\n    (click)=\"cancelAction()\">{{languageService.translate.instant('igo.geo.workspace.cancel')}}\n  </button>\n</div>","import { MatDialog } from '@angular/material/dialog';\nimport {\n  Workspace,\n  WorkspaceOptions,\n  EntityRecord\n} from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { EditionWorkspaceService } from './edition-workspace.service';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): ImageLayer | VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private filterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    protected options: EditionWorkspaceOptions,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private dialog: MatDialog,\n    private configService: ConfigService) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: {type: 'delete'}\n    });\n\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === false) {\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl = workspace.layer.dataSource.options.edition.deleteUrl;\n          let id;\n          let url;\n          if (baseUrl) {\n            url = this.configService.getConfig('edition.url') + baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url') + deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.editionWorkspaceService.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns ) {\n\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.editionWorkspaceService.getDomainValues(column.relation.table).subscribe(result => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(JSON.stringify(feature.properties));\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.editionWorkspaceService.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.filterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(feature, { newFeature: true }, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType, feature, workspace: EditionWorkspace) {\n      this.drawControl.setGeometryType(geometryType);\n      this.toggleDrawControl(feature, workspace);\n    }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.addFeatureToStore(feature, workspace, olGeometry);\n    });\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(feature, workspace: EditionWorkspace, olGeometry?: OlGeometry) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(olFeature: OlFeature<OlGeometry>, feature, workspace: EditionWorkspace) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach(feature => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton} from '@igo2/common';\nimport { ConfigService, LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(undefined);\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    public authInterceptor?: AuthInterceptor) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (layer.options.workspace?.enabled !== true || layer.dataSource.options.edition.enabled !== true) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        }, this, this.dialog, this.configService);\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            wksConfig\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: EditionWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [{\n      name: 'edition',\n      title: undefined,\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      primary: false,\n      valueAccessor: () => {\n        return [{\n          editMode: false,\n          icon: 'pencil',\n          color: 'primary',\n          click: (feature) => { workspace.editFeature(feature, workspace); }\n        },\n        {\n          editMode: false,\n          icon: 'delete',\n          color: 'warn',\n          click: (feature) => { workspace.deleteFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'check',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.saveFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'alpha-x',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.cancelEdit(workspace, feature); }\n        }] as EntityTableButton[];\n      }\n    }];\n\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: rendererType,\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: false,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation.table).subscribe(result => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)){\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    let url = this.configService.getConfig('edition.url');\n\n    if (workspace.layer.dataSource.options.edition.baseUrl) {\n      url += workspace.layer.dataSource.options.edition.baseUrl;\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (workspace.layer.dataSource.options.edition.modifyProtocol !== \"post\") {\n        url += '?' + workspace.layer.dataSource.options.edition.modifyUrl + feature.idkey;\n      }\n      else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole = workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders = workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}) {\n    // TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if (sf.name === property && sf.validation?.readonly) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http.post(`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        workspace.entityStore.stateView.clear();\n        workspace.deleteDrawings();\n        workspace.entityStore.delete(feature);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.addSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        this.adding$.next(false);\n        this.rowsInMapExtentCheckCondition$.next(true);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.deleteSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n          const genericErrorMessage = this.languageService.translate.instant(\n            'igo.geo.workspace.addError'\n          );\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach(message => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error(genericErrorMessage);\n            }\n          } else {\n            this.messageService.error(genericErrorMessage);\n          }\n      }\n    );\n  }\n\n  public modifyFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}, protocole = 'patch' ) {\n    //TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || property === 'boundedBy') {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.modifySuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n\n    if (feature.newFeature) {\n      workspace.entityStore.stateView.clear();\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(table: string): Observable<any> {\n    let url = this.configService.getConfig('edition.url') + table;\n\n    return this.http.get<any>(url).pipe(\n      map(result => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: IgoMap) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(layer.id.substr(0, layer.id.indexOf('.') - 1)) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      )\n        {\n          const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n          let params = wmsOlLayer.getParams();\n          params._t = new Date().getTime();\n          wmsOlLayer.updateParams(params);\n        }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    const translate = this.languageService.translate;\n    let message ;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys( column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (column.validation[type] && (!feature.properties.hasOwnProperty(key) || !feature.properties[key])) {\n                valid = false;\n                  message = translate.instant('igo.geo.formValidation.mandatory',\n                  {\n                    column: column.title\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] < column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] > column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length < column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length > column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            }\n          });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.type === 'list' && feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[getColumnKeyWithoutPropertiesTag(column.name)].toString();\n      }\n\n    });\n  }\n\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy, Output, EventEmitter } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.adding$.subscribe((adding) => { this.disableSwitch.emit(adding); });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => { this.relationLayers.emit(layers); });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe((condition) => {\n      this.rowsInMapExtentCheckCondition.emit(condition);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { Directive, Input, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceUpdator]'\n})\nexport class WorkspaceUpdatorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Input() workspaceStore: WorkspaceStore;\n\n  constructor(\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        if ((layer.dataSource.options as QueryableDataSourceOptions)?.queryFormatAsWms) {\n          (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = true;\n          return wmsWks;\n        }\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\n@NgModule({\n  imports: [],\n  exports: [],\n  declarations: []\n})\nexport class IgoWktModule {\n  static forRoot(): ModuleWithProviders<IgoWktModule> {\n    return {\n      ngModule: IgoWktModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { IgoCatalogModule } from './catalog/catalog.module';\nimport { IgoDataSourceModule } from './datasource/datasource.module';\nimport { IgoDownloadModule } from './download/download.module';\nimport { IgoDrawingToolModule } from './draw/drawingTool.module';\nimport { IgoFeatureModule } from './feature/feature.module';\nimport { IgoFilterModule } from './filter/filter.module';\nimport { IgoGeometryModule } from './geometry/geometry.module';\nimport { IgoImportExportModule } from './import-export/import-export.module';\nimport { IgoLayerModule } from './layer/layer.module';\nimport { IgoMapModule } from './map/map.module';\nimport { IgoMeasureModule } from './measure/measure.module';\nimport { IgoMetadataModule } from './metadata/metadata.module';\nimport { IgoOverlayModule } from './overlay/overlay.module';\nimport { IgoPrintModule } from './print/print.module';\nimport { IgoQueryModule } from './query/query.module';\nimport { IgoDirectionsModule } from './directions/directions.module';\nimport { IgoSearchModule } from './search/search.module';\nimport { IgoToastModule } from './toast/toast.module';\nimport { IgoGeoWorkspaceModule } from './workspace/workspace.module';\nimport { IgoWktModule } from './wkt/wkt.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoCatalogModule,\n    IgoDataSourceModule,\n    IgoDownloadModule,\n    IgoDrawingToolModule,\n    IgoFeatureModule,\n    IgoFilterModule,\n    IgoGeometryModule,\n    IgoImportExportModule,\n    IgoLayerModule,\n    IgoMapModule,\n    IgoMeasureModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoPrintModule,\n    IgoQueryModule,\n    IgoDirectionsModule,\n    IgoSearchModule,\n    IgoToastModule,\n    IgoGeoWorkspaceModule,\n    IgoWktModule\n  ]\n})\nexport class IgoGeoModule {\n  static forRoot(): ModuleWithProviders<IgoGeoModule> {\n    return {\n      ngModule: IgoGeoModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Québec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Québec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType(),\n      coordinates: feature.getGeometry().getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { EditionWorkspace } from './edition-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\n\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\n","/*\n * Public API Surface of geo\n */\n\nexport * from './lib/geo.module';\nexport * from './lib/catalog/catalog.module';\nexport * from './lib/catalog/catalog-browser/catalog-browser.module';\nexport * from './lib/catalog/catalog-library/catalog-library.module';\nexport * from './lib/datasource/datasource.module';\nexport * from './lib/directions/directions.module';\nexport * from './lib/download/download.module';\nexport * from './lib/draw/drawingTool.module';\nexport * from './lib/draw/draw/draw.module';\nexport * from './lib/workspace/workspace.module';\n\nexport * from './lib/feature/feature.module';\nexport * from './lib/feature/feature-form/feature-form.module';\nexport * from './lib/feature/feature-details/feature-details.module';\nexport * from './lib/feature/feature-details/feature-details.directive';\nexport * from './lib/filter/filter.module';\nexport * from './lib/geometry/geometry.module';\nexport * from './lib/geometry/geometry-form-field/geometry-form-field.module';\nexport * from './lib/import-export/import-export.module';\nexport * from './lib/layer/layer.module';\nexport * from './lib/map/map.module';\nexport * from './lib/measure/measure.module';\nexport * from './lib/measure/measurer/measurer.module';\nexport * from './lib/metadata/metadata.module';\nexport * from './lib/overlay/overlay.module';\nexport * from './lib/print/print.module';\nexport * from './lib/query/query.module';\nexport * from './lib/search/search.module';\nexport * from './lib/toast/toast.module';\nexport * from './lib/wkt/wkt.module';\n\nexport * from './lib/catalog';\nexport * from './lib/datasource';\nexport * from './lib/download';\nexport * from './lib/draw';\nexport * from './lib/feature';\nexport * from './lib/filter';\nexport * from './lib/geometry';\nexport * from './lib/import-export';\nexport * from './lib/layer';\nexport * from './lib/map';\nexport * from './lib/measure';\nexport * from './lib/metadata';\nexport * from './lib/overlay';\nexport * from './lib/print';\nexport * from './lib/query';\nexport * from './lib/directions';\nexport * from './lib/search';\nexport * from './lib/toast';\nexport * from './lib/utils';\nexport * from './lib/wkt';\nexport * from './lib/workspace';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["moment","olFormatWKT","OlFormat","olSourceVector","olLayerVector","ColorAsArray","extentGetWidth","extentGetTopLeft","olloadingstrategy","feature","OlFormatGeoJSON","olControlAttribution","olinteraction","olPoint","olFeature","olCircle","olVectorTileSource","OlGeom","OlStyle","OlRenderFeature","olGetLength","olGetArea","olGetCenter","Olstyle","olProj","Point","olStyle","olFormatGeoJSON","map","rxMap","olGeom"],"mappings":"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"}