import { TypeCatalog } from './catalog.enum';
export class Catalog {
    constructor(options, service) {
        Object.assign(this, options);
        this.catalogService = service;
    }
}
class WMSCatalog extends Catalog {
    constructor(options, service) {
        super(options, service);
        const sType = TypeCatalog[TypeCatalog.wms];
        this.type = TypeCatalog[sType];
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogWMSLayerItems(this);
    }
}
class WMTSCatalog extends Catalog {
    constructor(options, service) {
        super(options, service);
        const sType = TypeCatalog[TypeCatalog.wmts];
        this.type = TypeCatalog[sType];
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogWMTSLayerItems(this);
    }
}
class BaselayersCatalog extends Catalog {
    constructor(options, service) {
        super(options, service);
        const sType = TypeCatalog[TypeCatalog.baselayers];
        this.type = TypeCatalog[sType];
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogBaseLayerItems(this);
    }
}
class ArcGISRestCatalog extends Catalog {
    constructor(options, service) {
        super(options, service);
        const sType = TypeCatalog[TypeCatalog.arcgisrest];
        this.type = TypeCatalog[sType];
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogArcGISRestItems(this);
    }
}
class TileOrImageArcGISRestCatalog extends Catalog {
    constructor(options, service, typeCatalog) {
        super(options, service);
        this.type = TypeCatalog[TypeCatalog[typeCatalog]];
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogArcGISRestItems(this);
    }
}
export class CompositeCatalog extends Catalog {
    constructor(options, service) {
        super(options, service);
        const sType = TypeCatalog[TypeCatalog.composite];
        this.type = TypeCatalog[sType];
        this.url = null;
    }
    collectCatalogItems() {
        return this.catalogService.loadCatalogCompositeLayerItems(this);
    }
}
export class CatalogFactory {
    static createInstanceCatalog(options, service) {
        let catalog;
        if (options.hasOwnProperty('composite')) {
            catalog = new CompositeCatalog(options, service);
        }
        else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {
            catalog = new BaselayersCatalog(options, service);
        }
        else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {
            catalog = new ArcGISRestCatalog(options, service);
        }
        else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {
            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);
        }
        else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {
            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);
        }
        else if (options.type === TypeCatalog[TypeCatalog.wmts]) {
            catalog = new WMTSCatalog(options, service);
        }
        else {
            catalog = new WMSCatalog(options, service);
        }
        return catalog;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2F0YWxvZy5hYnN0cmFjdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2dlby9zcmMvbGliL2NhdGFsb2cvc2hhcmVkL2NhdGFsb2cuYWJzdHJhY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBUUEsT0FBTyxFQUFFLFdBQVcsRUFBc0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRSxNQUFNLE9BQWdCLE9BQU87SUFnQ3pCLFlBQVksT0FBZ0IsRUFBRSxPQUF1QjtRQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FBQztJQUNsQyxDQUFDO0NBR0o7QUFFRCxNQUFNLFVBQVcsU0FBUSxPQUFPO0lBQzVCLFlBQVksT0FBZ0IsRUFBRSxPQUF1QjtRQUNqRCxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sS0FBSyxHQUFXLFdBQVcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkQsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVNLG1CQUFtQjtRQUN0QixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUQsQ0FBQztDQUNKO0FBRUQsTUFBTSxXQUFZLFNBQVEsT0FBTztJQUM3QixZQUFZLE9BQWdCLEVBQUUsT0FBdUI7UUFDakQsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN4QixNQUFNLEtBQUssR0FBVyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFTSxtQkFBbUI7UUFDdEIsT0FBTyxJ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QUFPLEdBQUcsSUFBSSw0QkFBNEIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztTQUM1RjthQUFNLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxXQUFXLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxFQUFFO1lBQ2xFLE9BQU8sR0FBRyxJQUFJLDRCQUE0QixDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1NBQzdGO2FBQU0sSUFBSSxPQUFPLENBQUMsSUFBSSxLQUFLLFdBQVcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDdkQsT0FBTyxHQUFHLElBQUksV0FBVyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztTQUMvQzthQUFNO1lBQ0gsT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztTQUM5QztRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgVG9vbHRpcFR5cGUgfSBmcm9tICcuLi8uLi9sYXllcic7XG5pbXBvcnQgeyBUaW1lRmlsdGVyT3B0aW9ucyB9IGZyb20gJy4uLy4uL2ZpbHRlcic7XG5pbXBvcnQgeyBRdWVyeUZvcm1hdCwgUXVlcnlIdG1sVGFyZ2V0IH0gZnJvbSAnLi4vLi4vcXVlcnknO1xuXG5pbXBvcnQgeyBJQ2F0YWxvZywgSUNvbXBvc2l0ZUNhdGFsb2cgLCBDYXRhbG9nSXRlbSwgQ2F0YWxvZ0l0ZW1Hcm91cCB9IGZyb20gJy4vY2F0YWxvZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ2F0YWxvZ1NlcnZpY2UgfSBmcm9tICcuL2NhdGFsb2cuc2VydmljZSc7XG5pbXBvcnQgeyBUeXBlQ2F0YWxvZywgVHlwZUNhdGFsb2dTdHJpbmdzIH0gZnJvbSAnLi9jYXRhbG9nLmVudW0nO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2F0YWxvZyBpbXBsZW1lbnRzIElDYXRhbG9nIHtcblxuICAgIC8vIElDYXRhbG9nIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgaWQ6IHN0cmluZztcbiAgICB0aXRsZTogc3RyaW5nO1xuICAgIHVybDogc3RyaW5nO1xuICAgIHJlbW92YWJsZT86IGJvb2xlYW47XG4gICAgZXh0ZXJuYWxQcm92aWRlcj86IGJvb2xlYW47XG4gICAgYWJzdHJhY3Q/OiBzdHJpbmc7XG4gICAgZm9yY2VkUHJvcGVydGllcz86IGFueVtdO1xuICAgIGl0ZW1zPzogQ2F0YWxvZ0l0ZW1bXTtcbiAgICB0eXBlPzogVHlwZUNhdGFsb2dTdHJpbmdzO1xuICAgIHZlcnNpb24/OiBzdHJpbmc7XG4gICAgbWF0cml4U2V0Pzogc3RyaW5nO1xuICAgIHJlcXVlc3RFbmNvZGluZz86IHN0cmluZztcbiAgICByZWdGaWx0ZXJzPzogc3RyaW5nW107XG4gICAgZ3JvdXBJbXBvc2U/OiBDYXRhbG9nSXRlbUdyb3VwO1xuICAgIGdyb3VwU2VwYXJhdG9yPzogc3RyaW5nO1xuICAgIHRpbWVGaWx0ZXI/OiBUaW1lRmlsdGVyT3B0aW9ucztcbiAgICBxdWVyeUZvcm1hdD86IFF1ZXJ5Rm9ybWF0O1xuICAgIHF1ZXJ5SHRtbFRhcmdldD86IFF1ZXJ5SHRtbFRhcmdldDtcbiAgICBxdWVyeVBhcmFtcz86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nOyB9O1xuICAgIHNvdXJjZU9wdGlvbnM/OiB7IFtrZXk6IHN0cmluZ106IGFueTsgfTtcbiAgICBjb3VudD86IG51bWJlcjtcbiAgICB0b29sdGlwVHlwZT86IFRvb2x0aXBUeXBlLkFCU1RSQUNUIHwgVG9vbHRpcFR5cGUuVElUTEU7XG4gICAgc29ydERpcmVjdGlvbj86ICdhc2MnIHwgJ2Rlc2MnO1xuICAgIHNldENyb3NzT3JpZ2luQW5vbnltb3VzPzogYm9vbGVhbjtcbiAgICBzaG93TGVnZW5kPzogYm9vbGVhbjtcbiAgICAvLyBJQ2F0YWxvZyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgcHJvdGVjdGVkIGNhdGFsb2dTZXJ2aWNlOiBDYXRhbG9nU2VydmljZTtcblxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IENhdGFsb2csIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlKSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuY2F0YWxvZ1NlcnZpY2UgPSBzZXJ2aWNlO1xuICAgIH1cblxuICAgIHB1YmxpYyBhYnN0cmFjdCBjb2xsZWN0Q2F0YWxvZ0l0ZW1zKCk6IE9ic2VydmFibGU8Q2F0YWxvZ0l0ZW1bXT47XG59XG5cbmNsYXNzIFdNU0NhdGFsb2cgZXh0ZW5kcyBDYXRhbG9nIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBDYXRhbG9nLCBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSkge1xuICAgICAgICBzdXBlcihvcHRpb25zLCBzZXJ2aWNlKTtcbiAgICAgICAgY29uc3Qgc1R5cGU6IHN0cmluZyA9IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nLndtc107XG4gICAgICAgIHRoaXMudHlwZSA9IFR5cGVDYXRhbG9nW3NUeXBlXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29sbGVjdENhdGFsb2dJdGVtcygpOiBPYnNlcnZhYmxlPENhdGFsb2dJdGVtW10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2F0YWxvZ1NlcnZpY2UubG9hZENhdGFsb2dXTVNMYXllckl0ZW1zKHRoaXMpO1xuICAgIH1cbn1cblxuY2xhc3MgV01UU0NhdGFsb2cgZXh0ZW5kcyBDYXRhbG9nIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBDYXRhbG9nLCBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSkge1xuICAgICAgICBzdXBlcihvcHRpb25zLCBzZXJ2aWNlKTtcbiAgICAgICAgY29uc3Qgc1R5cGU6IHN0cmluZyA9IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nLndtdHNdO1xuICAgICAgICB0aGlzLnR5cGUgPSBUeXBlQ2F0YWxvZ1tzVHlwZV07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbGxlY3RDYXRhbG9nSXRlbXMoKTogT2JzZXJ2YWJsZTxDYXRhbG9nSXRlbVtdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhdGFsb2dTZXJ2aWNlLmxvYWRDYXRhbG9nV01UU0xheWVySXRlbXModGhpcyk7XG4gICAgfVxufVxuXG5jbGFzcyBCYXNlbGF5ZXJzQ2F0YWxvZyBleHRlbmRzIENhdGFsb2cge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IENhdGFsb2csIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMsIHNlcnZpY2UpO1xuICAgICAgICBjb25zdCBzVHlwZTogc3RyaW5nID0gVHlwZUNhdGFsb2dbVHlwZUNhdGFsb2cuYmFzZWxheWVyc107XG4gICAgICAgIHRoaXMudHlwZSA9IFR5cGVDYXRhbG9nW3NUeXBlXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29sbGVjdENhdGFsb2dJdGVtcygpOiBPYnNlcnZhYmxlPENhdGFsb2dJdGVtR3JvdXBbXT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYXRhbG9nU2VydmljZS5sb2FkQ2F0YWxvZ0Jhc2VMYXllckl0ZW1zKHRoaXMpO1xuICAgIH1cbn1cblxuY2xhc3MgQXJjR0lTUmVzdENhdGFsb2cgZXh0ZW5kcyBDYXRhbG9nIHtcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBDYXRhbG9nLCBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSkge1xuICAgICAgICBzdXBlcihvcHRpb25zLCBzZXJ2aWNlKTtcbiAgICAgICAgY29uc3Qgc1R5cGU6IHN0cmluZyA9IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nLmFyY2dpc3Jlc3RdO1xuICAgICAgICB0aGlzLnR5cGUgPSBUeXBlQ2F0YWxvZ1tzVHlwZV07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbGxlY3RDYXRhbG9nSXRlbXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhdGFsb2dTZXJ2aWNlLmxvYWRDYXRhbG9nQXJjR0lTUmVzdEl0ZW1zKHRoaXMpO1xuICAgIH1cbn1cblxuY2xhc3MgVGlsZU9ySW1hZ2VBcmNHSVNSZXN0Q2F0YWxvZyBleHRlbmRzIENhdGFsb2cge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IENhdGFsb2csIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlLCB0eXBlQ2F0YWxvZzogVHlwZUNhdGFsb2cpIHtcbiAgICAgICAgc3VwZXIob3B0aW9ucywgc2VydmljZSk7XG4gICAgICAgIHRoaXMudHlwZSA9IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nW3R5cGVDYXRhbG9nXV07XG4gICAgfVxuXG4gICAgcHVibGljIGNvbGxlY3RDYXRhbG9nSXRlbXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhdGFsb2dTZXJ2aWNlLmxvYWRDYXRhbG9nQXJjR0lTUmVzdEl0ZW1zKHRoaXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbXBvc2l0ZUNhdGFsb2cgZXh0ZW5kcyBDYXRhbG9nIGltcGxlbWVudHMgSUNvbXBvc2l0ZUNhdGFsb2cge1xuICAgIGNvbXBvc2l0ZTogSUNhdGFsb2dbXTtcblxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IENhdGFsb2csIHNlcnZpY2U6IENhdGFsb2dTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKG9wdGlvbnMsIHNlcnZpY2UpO1xuICAgICAgICBjb25zdCBzVHlwZTogc3RyaW5nID0gVHlwZUNhdGFsb2dbVHlwZUNhdGFsb2cuY29tcG9zaXRlXTtcbiAgICAgICAgdGhpcy50eXBlID0gVHlwZUNhdGFsb2dbc1R5cGVdO1xuICAgICAgICB0aGlzLnVybCA9IG51bGw7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbGxlY3RDYXRhbG9nSXRlbXMoKTogT2JzZXJ2YWJsZTxDYXRhbG9nSXRlbVtdPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhdGFsb2dTZXJ2aWNlLmxvYWRDYXRhbG9nQ29tcG9zaXRlTGF5ZXJJdGVtcyh0aGlzKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDYXRhbG9nRmFjdG9yeSB7XG5cbiAgICBwdWJsaWMgc3RhdGljIGNyZWF0ZUluc3RhbmNlQ2F0YWxvZyhvcHRpb25zOiBDYXRhbG9nLCBzZXJ2aWNlOiBDYXRhbG9nU2VydmljZSk6IENhdGFsb2cge1xuXG4gICAgICAgIGxldCBjYXRhbG9nOiBDYXRhbG9nO1xuICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eSgnY29tcG9zaXRlJykpIHtcbiAgICAgICAgICAgIGNhdGFsb2cgPSBuZXcgQ29tcG9zaXRlQ2F0YWxvZyhvcHRpb25zLCBzZXJ2aWNlKTtcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnR5cGUgPT09IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nLmJhc2VsYXllcnNdKSB7XG4gICAgICAgICAgICBjYXRhbG9nID0gbmV3IEJhc2VsYXllcnNDYXRhbG9nKG9wdGlvbnMsIHNlcnZpY2UpO1xuICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMudHlwZSA9PT0gVHlwZUNhdGFsb2dbVHlwZUNhdGFsb2cuYXJjZ2lzcmVzdF0pIHtcbiAgICAgICAgICAgIGNhdGFsb2cgPSBuZXcgQXJjR0lTUmVzdENhdGFsb2cob3B0aW9ucywgc2VydmljZSk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy50eXBlID09PSBUeXBlQ2F0YWxvZ1tUeXBlQ2F0YWxvZy50aWxlYXJjZ2lzcmVzdF0pIHtcbiAgICAgICAgICAgIGNhdGFsb2cgPSBuZXcgVGlsZU9ySW1hZ2VBcmNHSVNSZXN0Q2F0YWxvZyhvcHRpb25zLCBzZXJ2aWNlLCBUeXBlQ2F0YWxvZy50aWxlYXJjZ2lzcmVzdCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy50eXBlID09PSBUeXBlQ2F0YWxvZ1tUeXBlQ2F0YWxvZy5pbWFnZWFyY2dpc3Jlc3RdKSB7XG4gICAgICAgICAgICBjYXRhbG9nID0gbmV3IFRpbGVPckltYWdlQXJjR0lTUmVzdENhdGFsb2cob3B0aW9ucywgc2VydmljZSwgVHlwZUNhdGFsb2cuaW1hZ2VhcmNnaXNyZXN0KTtcbiAgICAgICAgfSBlbHNlIGlmIChvcHRpb25zLnR5cGUgPT09IFR5cGVDYXRhbG9nW1R5cGVDYXRhbG9nLndtdHNdKSB7XG4gICAgICAgICAgICBjYXRhbG9nID0gbmV3IFdNVFNDYXRhbG9nKG9wdGlvbnMsIHNlcnZpY2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2F0YWxvZyA9IG5ldyBXTVNDYXRhbG9nKG9wdGlvbnMsIHNlcnZpY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNhdGFsb2c7XG4gICAgfVxufVxuIl19