import { Injectable } from '@angular/core';
import { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';
import { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';
import * as i0 from "@angular/core";
export class TimeFilterService {
    constructor() { }
    filterByDate(datasource, date) {
        let time;
        let newdateform;
        let newdateformStart;
        let newdateformEnd;
        if (Array.isArray(date)) {
            const dates = [];
            if (date[0]) {
                newdateformStart = this.reformatDateTime(date[0]);
                dates.push(date[0]);
            }
            if (date[1]) {
                newdateformEnd = this.reformatDateTime(date[1]);
                dates.push(date[1]);
            }
            if (dates.length === 2 && newdateformStart !== newdateformEnd) {
                if (datasource instanceof TileArcGISRestDataSource) {
                    time = newdateformStart + ',' + newdateformEnd;
                }
                else {
                    time = newdateformStart + '/' + newdateformEnd;
                }
            }
            if (newdateformStart === newdateformEnd) {
                time = newdateformStart;
            }
        }
        else if (date) {
            newdateform = this.reformatDateTime(date);
            time = newdateform;
        }
        const params = { TIME: time };
        datasource.ol.updateParams(params);
        if (datasource instanceof WMSDataSource) {
            const wmsDataSource = datasource;
            wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);
        }
    }
    filterByYear(datasource, year) {
        let time;
        let newdateformStart;
        let newdateformEnd;
        if (Array.isArray(year)) {
            const years = [];
            if (year[0]) {
                newdateformStart = year[0];
                years.push(year[0]);
            }
            if (year[1]) {
                newdateformEnd = year[1];
                years.push(year[1]);
            }
            if (years.length === 2 && newdateformStart !== newdateformEnd) {
                if (datasource instanceof TileArcGISRestDataSource) {
                    time = newdateformStart + ',' + newdateformEnd;
                }
                else {
                    time = newdateformStart + '/' + newdateformEnd;
                }
            }
            if (newdateformStart === newdateformEnd) {
                time = newdateformStart;
            }
        }
        else { // to reset filter.
            time = year;
        }
        const params = { TIME: time };
        datasource.ol.updateParams(params);
        if (datasource instanceof WMSDataSource) {
            const wmsDataSource = datasource;
            wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);
        }
    }
    reformatDateTime(value) {
        const year = value.getFullYear();
        let month = value.getMonth() + 1;
        let day = value.getUTCDate();
        let hour = value.getUTCHours();
        let minute = value.getUTCMinutes();
        if (Number(month) < 10) {
            month = '0' + month;
        }
        if (Number(day) < 10) {
            day = '0' + day;
        }
        if (Number(hour) < 10) {
            hour = '0' + hour;
        }
        if (Number(minute) < 10) {
            minute = '0' + minute;
        }
        return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';
    }
}
TimeFilterService.ɵfac = function TimeFilterService_Factory(t) { return new (t || TimeFilterService)(); };
TimeFilterService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: TimeFilterService, factory: TimeFilterService.ɵfac });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(TimeFilterService, [{
        type: Injectable
    }], function () { return []; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1maWx0ZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL2dlby9zcmMvbGliL2ZpbHRlci9zaGFyZWQvdGltZS1maWx0ZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUNuRixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwrREFBK0QsQ0FBQzs7QUFHekcsTUFBTSxPQUFPLGlCQUFpQjtJQUM1QixnQkFBZSxDQUFDO0lBRWhCLFlBQVksQ0FDVixVQUFvRCxFQUNwRCxJQUF5QjtRQUV6QixJQUFJLElBQUksQ0FBQztRQUNULElBQUksV0FBVyxDQUFDO1FBQ2hCLElBQUksZ0JBQWdCLENBQUM7UUFDckIsSUFBSSxjQUFjLENBQUM7UUFFbkIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNqQixJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDWCxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xELEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDckI7WUFDRCxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRTtnQkFDWCxjQUFjLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNoRCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ3JCO1lBQ0QsSUFBSSxLQUFLLENBQUMsTUFBTSxL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QVUsRUFBRSxDQUFDO1FBQzdCLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFbkMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3RCLEtBQUssR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDO1NBQ3JCO1FBRUQsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3BCLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO1NBQ2pCO1FBRUQsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3JCLElBQUksR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDO1NBQ25CO1FBRUQsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3ZCLE1BQU0sR0FBRyxHQUFHLEdBQUcsTUFBTSxDQUFDO1NBQ3ZCO1FBRUQsT0FBTyxJQUFJLEdBQUcsR0FBRyxHQUFHLEtBQUssR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxJQUFJLEdBQUcsR0FBRyxHQUFHLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDN0UsQ0FBQzs7a0ZBN0dVLGlCQUFpQjt1RUFBakIsaUJBQWlCLFdBQWpCLGlCQUFpQjt1RkFBakIsaUJBQWlCO2NBRDdCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFdNU0RhdGFTb3VyY2UgfSBmcm9tICcuLi8uLi9kYXRhc291cmNlL3NoYXJlZC9kYXRhc291cmNlcy93bXMtZGF0YXNvdXJjZSc7XG5pbXBvcnQgeyBUaWxlQXJjR0lTUmVzdERhdGFTb3VyY2UgfSBmcm9tICcuLi8uLi9kYXRhc291cmNlL3NoYXJlZC9kYXRhc291cmNlcy90aWxlYXJjZ2lzcmVzdC1kYXRhc291cmNlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRpbWVGaWx0ZXJTZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIGZpbHRlckJ5RGF0ZShcbiAgICBkYXRhc291cmNlOiBXTVNEYXRhU291cmNlIHwgVGlsZUFyY0dJU1Jlc3REYXRhU291cmNlLFxuICAgIGRhdGU6IERhdGUgfCBbRGF0ZSwgRGF0ZV1cbiAgKSB7XG4gICAgbGV0IHRpbWU7XG4gICAgbGV0IG5ld2RhdGVmb3JtO1xuICAgIGxldCBuZXdkYXRlZm9ybVN0YXJ0O1xuICAgIGxldCBuZXdkYXRlZm9ybUVuZDtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGUpKSB7XG4gICAgICBjb25zdCBkYXRlcyA9IFtdO1xuICAgICAgaWYgKGRhdGVbMF0pIHtcbiAgICAgICAgbmV3ZGF0ZWZvcm1TdGFydCA9IHRoaXMucmVmb3JtYXREYXRlVGltZShkYXRlWzBdKTtcbiAgICAgICAgZGF0ZXMucHVzaChkYXRlWzBdKTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRlWzFdKSB7XG4gICAgICAgIG5ld2RhdGVmb3JtRW5kID0gdGhpcy5yZWZvcm1hdERhdGVUaW1lKGRhdGVbMV0pO1xuICAgICAgICBkYXRlcy5wdXNoKGRhdGVbMV0pO1xuICAgICAgfVxuICAgICAgaWYgKGRhdGVzLmxlbmd0aCA9PT0gMiAmJiBuZXdkYXRlZm9ybVN0YXJ0ICE9PSBuZXdkYXRlZm9ybUVuZCkge1xuICAgICAgICBpZiAoZGF0YXNvdXJjZSBpbnN0YW5jZW9mIFRpbGVBcmNHSVNSZXN0RGF0YVNvdXJjZSkge1xuICAgICAgICAgIHRpbWUgPSBuZXdkYXRlZm9ybVN0YXJ0ICsgJywnICsgbmV3ZGF0ZWZvcm1FbmQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGltZSA9IG5ld2RhdGVmb3JtU3RhcnQgKyAnLycgKyBuZXdkYXRlZm9ybUVuZDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG5ld2RhdGVmb3JtU3RhcnQgPT09IG5ld2RhdGVmb3JtRW5kKSB7XG4gICAgICAgIHRpbWUgPSBuZXdkYXRlZm9ybVN0YXJ0O1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGF0ZSkge1xuICAgICAgbmV3ZGF0ZWZvcm0gPSB0aGlzLnJlZm9ybWF0RGF0ZVRpbWUoZGF0ZSk7XG4gICAgICB0aW1lID0gbmV3ZGF0ZWZvcm07XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zID0geyBUSU1FOiB0aW1lIH07XG4gICAgZGF0YXNvdXJjZS5vbC51cGRhdGVQYXJhbXMocGFyYW1zKTtcbiAgICBpZiAoZGF0YXNvdXJjZSBpbnN0YW5jZW9mIFdNU0RhdGFTb3VyY2UpIHtcbiAgICAgIGNvbnN0IHdtc0RhdGFTb3VyY2UgPSBkYXRhc291cmNlIGFzIFdNU0RhdGFTb3VyY2U7XG4gICAgICB3bXNEYXRhU291cmNlLnNldFRpbWVGaWx0ZXIod21zRGF0YVNvdXJjZS50aW1lRmlsdGVyLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBmaWx0ZXJCeVllYXIoXG4gICAgZGF0YXNvdXJjZTogV01TRGF0YVNvdXJjZSB8IFRpbGVBcmNHSVNSZXN0RGF0YVNvdXJjZSxcbiAgICB5ZWFyOiBzdHJpbmcgfCBbc3RyaW5nLCBzdHJpbmddXG4gICkge1xuICAgIGxldCB0aW1lO1xuICAgIGxldCBuZXdkYXRlZm9ybVN0YXJ0O1xuICAgIGxldCBuZXdkYXRlZm9ybUVuZDtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KHllYXIpKSB7XG4gICAgICBjb25zdCB5ZWFycyA9IFtdO1xuICAgICAgaWYgKHllYXJbMF0pIHtcbiAgICAgICAgbmV3ZGF0ZWZvcm1TdGFydCA9IHllYXJbMF07XG4gICAgICAgIHllYXJzLnB1c2goeWVhclswXSk7XG4gICAgICB9XG4gICAgICBpZiAoeWVhclsxXSkge1xuICAgICAgICBuZXdkYXRlZm9ybUVuZCA9IHllYXJbMV07XG4gICAgICAgIHllYXJzLnB1c2goeWVhclsxXSk7XG4gICAgICB9XG4gICAgICBpZiAoeWVhcnMubGVuZ3RoID09PSAyICYmIG5ld2RhdGVmb3JtU3RhcnQgIT09IG5ld2RhdGVmb3JtRW5kKSB7XG4gICAgICAgIGlmIChkYXRhc291cmNlIGluc3RhbmNlb2YgVGlsZUFyY0dJU1Jlc3REYXRhU291cmNlKSB7XG4gICAgICAgICAgdGltZSA9IG5ld2RhdGVmb3JtU3RhcnQgKyAnLCcgKyBuZXdkYXRlZm9ybUVuZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aW1lID0gbmV3ZGF0ZWZvcm1TdGFydCArICcvJyArIG5ld2RhdGVmb3JtRW5kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobmV3ZGF0ZWZvcm1TdGFydCA9PT0gbmV3ZGF0ZWZvcm1FbmQpIHtcbiAgICAgICAgdGltZSA9IG5ld2RhdGVmb3JtU3RhcnQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHsgLy8gdG8gcmVzZXQgZmlsdGVyLlxuICAgICAgdGltZSA9IHllYXI7XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zID0geyBUSU1FOiB0aW1lIH07XG4gICAgZGF0YXNvdXJjZS5vbC51cGRhdGVQYXJhbXMocGFyYW1zKTtcbiAgICBpZiAoZGF0YXNvdXJjZSBpbnN0YW5jZW9mIFdNU0RhdGFTb3VyY2UpIHtcbiAgICAgIGNvbnN0IHdtc0RhdGFTb3VyY2UgPSBkYXRhc291cmNlIGFzIFdNU0RhdGFTb3VyY2U7XG4gICAgICB3bXNEYXRhU291cmNlLnNldFRpbWVGaWx0ZXIod21zRGF0YVNvdXJjZS50aW1lRmlsdGVyLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZm9ybWF0RGF0ZVRpbWUodmFsdWUpIHtcbiAgICBjb25zdCB5ZWFyID0gdmFsdWUuZ2V0RnVsbFllYXIoKTtcbiAgICBsZXQgbW9udGggPSB2YWx1ZS5nZXRNb250aCgpICsgMTtcbiAgICBsZXQgZGF5ID0gdmFsdWUuZ2V0VVRDRGF0ZSgpO1xuICAgIGxldCBob3VyID0gdmFsdWUuZ2V0VVRDSG91cnMoKTtcbiAgICBsZXQgbWludXRlID0gdmFsdWUuZ2V0VVRDTWludXRlcygpO1xuXG4gICAgaWYgKE51bWJlcihtb250aCkgPCAxMCkge1xuICAgICAgbW9udGggPSAnMCcgKyBtb250aDtcbiAgICB9XG5cbiAgICBpZiAoTnVtYmVyKGRheSkgPCAxMCkge1xuICAgICAgZGF5ID0gJzAnICsgZGF5O1xuICAgIH1cblxuICAgIGlmIChOdW1iZXIoaG91cikgPCAxMCkge1xuICAgICAgaG91ciA9ICcwJyArIGhvdXI7XG4gICAgfVxuXG4gICAgaWYgKE51bWJlcihtaW51dGUpIDwgMTApIHtcbiAgICAgIG1pbnV0ZSA9ICcwJyArIG1pbnV0ZTtcbiAgICB9XG5cbiAgICByZXR1cm4geWVhciArICctJyArIG1vbnRoICsgJy0nICsgZGF5ICsgJ1QnICsgaG91ciArICc6JyArIG1pbnV0ZSArICc6MDBaJztcbiAgfVxufVxuIl19